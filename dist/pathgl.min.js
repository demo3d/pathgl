!function(){function t(i){this.keys_=t.prototype.PQKeyRenew_(!1,t.INIT_SIZE_),this.order_=!1,this.size_=0,this.max_=t.INIT_SIZE_,this.initialized_=!1,this.leq_=i,this.heap_=new e(this.leq_)}function e(t){this.ns_=i.renew(!1,e.INIT_SIZE_+1),this.handles_=n.renew(!1,e.INIT_SIZE_+1),this.size_=0,this.max_=e.INIT_SIZE_,this.fList_=0,this.initialized_=!1,this.leq_=t,this.ns_[1].handle=1}function i(){this.handle=0}function n(){this.key=!1,this.n=0}function r(){}function o(t){return t}function s(t){return[].push.call(this,t)}function a(t){return t&&!(t&t-1)}function l(t){return Math.pow(Math.ceil(Math.sqrt(t)),2)}function p(t,e){for(var i in t)e(t[i],i,t)}function u(){return[-1,-1,1,-1,-1,1,1,1]}function h(t){return t.split(".").pop().join().match(/mp4|ogg|webm/)}function c(t,e){for(var i=e-t,n=new Array(i),r=0;i>r;)n[r]=t+r++;return n}function f(){return a(this.height)&&a(this.width)&&(this.data||{}).constructor!==HTMLVideoElement&&this.data}function d(t,e){if(arguments.length>2)[].forEach.call(arguments,function(e){d(t,e)});else for(var i in e)t[i]=e[i];return t}function _(t,e){!t||t.complete||4==t.readyState?e():t.addEventListener&&t.addEventListener("load",e)}function y(t,e){t||console.log(e)}function g(t){var e=x(t);return+(255*e[0])<<16^255*e[1]<<8^255*e[2]<<0}function v(t){return t=Math.floor(t),[(255&t>>16)/255,(255&t>>8)/255,(255&t)/255]}function m(t,e,i){if(0===e)return[i,i,i];var n=.5>=i?i*(1+e):i+e-i*e,r=2*i-n;return[S(r,n,t+1/3),S(r,n,t),S(r,n,t-1/3)]}function S(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+6*(e-t)*(2/3-i):t}function x(t){if(qe[t])return v(qe[t]);if(/^hsl/i.test(t)){var e=t.split(/,|\(/).map(parseFloat);return m(e[1]/360,e[2]/100,e[3]/100)}if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(t)){var i=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(t);return[Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255]}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(t)){var i=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(t);return[Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100]}if(/^\#([0-9a-f]{6})$/i.test(t)){var i=/^\#([0-9a-f]{6})$/i.exec(t);return v(parseInt(i[1],16))}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(t)){var i=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(t);return v(parseInt(i[1]+i[1]+i[2]+i[2]+i[3]+i[3],16))}return!1}function E(){function t(){for(var t=-1;++t<l;)h.update()}function e(){}function i(){}function n(){}function r(){return h.mergeProgram(Ve,$e),this}function o(){Ce.push(t),p.forEach(function(t){t.invalidate()})}function s(t){var e=t().shared("uv","tex1.xy").map("gl_fragcolor = texel(uv);").pipe(p),i=t().sort("float comparator(vec2 a, vec2 b) { return a > b ? a : b }").map("bsearch").pipe(e),n="void main (){float a = texel(uv);float maxC = max(a.r, a.g, a.b)float minC = min(a.r, a.g, a.b)float lightness = (maxC + minC) * .5float  delta = maxC - minCfloat saturation = lightness <= 0.5 ? delta / ( maxC + minC ) : delta / ( 2 - maxC - minC )float hue = maxC == a.r ?  (a.g - a.b ) / delta + ( a.g < a.b ? 6 : 0 ): maxC == a.g  ? ( a.b - a.r ) / delta + 2: ( a.r - a.g ) / delta + 4;hue /= 6gl_FragColor = vec3(hue, saturation, threadIdx.xy);}";return dependencies.map(function(r){var o=t().blocksize(64,64).gridsize(8,8).map(n).reduce(t).pipe(i);r.pipe(o),r[1].pipe(e)}),this}function a(t){return h.drawTo(t),t&&p.push(t),u}var l=2,p=[],u={scatter:e,reduce:n,scan:i,map:r,match:s,pipe:a,invalidate:o},h=Y({gl:Fe,mesh:w()});return u}function w(){return j(Fe,{pos:{array:u(),size:2},attrList:["pos"],count:4,primitive:"triangle_strip"})}function L(t,e,i,n){function r(e,i){var n,r=t.getUniformLocation(be,e),o="uniform"+F(i)+"fv";be[e]=function(e){n!=e&&arguments.length&&(t[o](r,Array.isArray(e)?e:[e]),n=e)}}var o=e+"\n"+i;be=t.createProgram(),be.shit=Math.random(0);var s=C(t,t.VERTEX_SHADER,e),a=C(t,t.FRAGMENT_SHADER,i);if(t.attachShader(be,s),t.attachShader(be,a),t.deleteShader(s),t.deleteShader(a),(n||["pos","color","fugue"]).forEach(function(e,i){t.bindAttribLocation(be,i,e)}),t.linkProgram(be),t.useProgram(be),!t.getProgramParameter(be,t.LINK_STATUS))throw name+": "+t.getProgramInfoLog(be);for(var l=/uniform\s+(\S+)\s+(\S+)\s*;/g,p=null;null!=(p=l.exec(o));)r(p[2],p[1]);return be.merge=b(s,a),be.gl=t,be}function T(t,e){p(e||{},function(t,e,i){"cx"==e&&(i.x=t),"cy"==e&&(i.y=t)});var i=d({stroke:"(color.r < 0.) ? vec4(stroke) : unpack_color(stroke)",r:"(pos.z < 0.) ? clamp(texel(pos.xy).w + texel(pos.xy).z, 2., 100.) : (2. * pos.z)",x:"(pos.x < 1.) ? texel(pos.xy).x * resolution.x : pos.x",y:"(pos.y < 1.) ? texel(pos.xy).y * resolution.y : pos.y"},e);for(var n in i)t=t.replace("replace_"+n,i[n]);return t}function C(t,e,i){var n="precision mediump float;\n",r=t.createShader(e);if(t.shaderSource(r,n+i),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){var o=t.getShaderInfoLog(r)||"",s=+o.split(":")[2];return console.error((i||"").split("\n").slice(s-5,s+5).join("\n"),o)}return r}function F(t){return t.match("vec")?t[t.length-1]:1}function b(){return function(t,e,i){return e=e||we.fragmentShader,t=T(t,i),L(this.gl,t,e)}}function A(t){if(we.options=we.options||{},!(Fe=M(canvas=t)))return!!console.log("webGL context could not be initialized");Fe.getExtension("OES_texture_float")||console.warn("does not support floating point textures"),be=L(Fe,T(we.vertexShader),we.fragmentShader),canvas.program=be,O(canvas),P(canvas);var e=Y(canvas);return e.drawTo(null),Ae.push(e.update),k(Fe),z(),Ae.push(function(){we.uniform("clock",new Date-Pe)}),canvas}function k(t){t.clearColor(0,0,0,0),t.blendFunc(t.ONE_MINUS_SRC_ALPHA,t.ONE)}function P(t){function e(){we.uniform("resolution",[t.width||960,t.height||500])}setInterval(e,100),t.addEventListener("click",I),t.addEventListener("mousemove",N),t.addEventListener("touchmove",q),t.addEventListener("touchstart",q)}function I(){}function N(t){var e=canvas.getBoundingClientRect(),i=t.clientX-e.left-canvas.clientLeft,n=t.clientY-e.top-canvas.clientTop;we.uniform("mouse",[i,n]),H(0|i,0|n)}function q(t){var e=canvas.getBoundingClientRect();t=t.touches[0],we.uniform("mouse",[t.clientX-e.left-canvas.clientLeft,t.clientY-e.top-canvas.clientTop])}function O(t){window.d3&&d(window.d3.selection.prototype,{vAttr:R,shader:U}),window.d3&&d(window.d3.transition.prototype,{vAttr:R,shader:U}),d(t,Oe).gl=Fe}function M(t){var e=t.getContext("webgl",we.options)||t.getContext("experimental-webgl",we.options);return e&&d(e,{viewportWidth:t.width,viewportHeight:t.height})}function R(t,e){return this.each(function(t,i){this.colorBuffer[this.indices[0]]=g(e(t,i))}),this}function U(t){return this.node().mesh.mergeProgram(we.vertexShader,we.fragmentShader,t),this}function z(){for(var t,e=Ae.length;e--;)Ae[e]();for(t=Ce,Ce=[],Re=t;Re.length;)Re.pop()();Me(z)}function D(t){De.Perp(0,0,1);var e=[];De.StartShape(e);for(var i=0;i<t.length;i++){De.StartCurve();for(var n=t[i],r=0;r<n.length;r+=2){var o=[n[r],n[r+1],0];De.point(o,o)}De.EndCurve()}return De.EndShape(),e}function B(){this.state=B.cond.T_SLEEP,this.perp=[0,0,0],this.s=[0,0,0],this.t=[0,0,0],this.relEpsilon=B._EPSILON,this.command=B.command.COMM_ODD,this.storeCount=0,this.store=new Array(B.MALA_MAX_STORE);for(var t=0;t<B.MALA_MAX_STORE;t++)this.store[t]=new B.storepoint}function W(t){var e=[],i=[0,0],n=[0,0],r=[e];t.slice().replace(/([MLHVCSQTAZmlhvcsqtaz])/g,"###$1").split(/###/).slice(1).forEach(function(t){for(var o=t.slice(1).trim().split(/\s|,|###/),s=0;s<o.length;){var a=o[s++],l=o[s++];switch(t[0].toLowerCase()){case"m":e.push(n[0],n[1]),n=i=[a,l],r.push(e=[]),e.push(i[0],i[1]);break;case"l":e.push(a,l),i=[a,l];break;case"z":i=n,e.push(i[0],i[1])}}}),this.indices=this.mesh.spread(this.indices,D(r))}function G(){if(!d3)return console.warn("this method depends on d3");d3.selectAll("link[rel=styleSheet]").each(function(){d3.text});var t=d3.selectAll("style")[0].map(function(){return this.sheet}).reduce(function(t,e){var i={};return p(e.cssRules,function(t){for(var e=t.length,n={};e--;){var r=t[t[e]];n[r]=t[r]}i[t.selectorText]=n}),d(t,i)},{});p(t,function(t,e){d3.select(e).attr(t)})}function X(t,e){(Be[0|this.attr.cx]=Be[0|this.attr.cx]||{})[0|this.attr.cy]=this,this.mouseover=e}function H(t,e){Be[t]&&Be[t][e]&&Be[t][e].trigger("mousemove")}function j(t,e){function i(){return"triangles"==e.primitive?_=1e5:_+="points"==e.primitive?1:"lines"==e.primitive?2:3}function n(t,e){var i=e.length-t.length;i>0?t=t.concat(m.splice(0,i)):m=m.concat(t.splice(0,-i));var n=d.pos.array;return t.forEach(function(t){n[t]=e[t]}),t}function r(){y.forEach(function(i,n){var r=t.createBuffer(),o=e[i]||{};t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,4e7,t.STREAM_DRAW),d[i]={array:new Float32Array(e[i]&&e[i].array||4e5),buffer:r,size:o.size||4,changed:!0,loc:n}})}function o(t){var e,i;for(i in d)for(i=d,e=i.size;e--;)d[t*i.size+e]=0}function s(t){t.posBuffer=d.pos.array,t.fBuffer=d.fugue.array,t.colorBuffer=d.color.array,t.mesh=this}function a(e){if(_){for(var i in d)i=d[i],t.bindBuffer(t.ARRAY_BUFFER,i.buffer),t.vertexAttribPointer(i.loc,i.size,t.FLOAT,!1,0,0),t.enableVertexAttribArray(i.loc),i.changed&&t.bufferSubData(t.ARRAY_BUFFER,0,i.array);t.drawArrays(g,e,_)}}function l(){}function p(){}function u(){}function h(){}function f(t,e){~v.indexOf(e)||v.push(e)}var d={},_=e.count||0,y=e.attrList||["pos","color","fugue"],g=t[e.primitive.toUpperCase()],v=[],m=c(0,1e6);r();var S={init:r,free:o,tessOffset:0,alloc:i,draw:a,bind:s,bindMaterial:f,attributes:d,set:l,addAttr:p,removeAttr:u,boundingBox:h,spread:n};return S}function Y(t){function e(e){return e?(l.push($(e)),t.width=e.width,t.height=e.height,void 0):l.push(null)}function i(t){return(u[t.toLowerCase()]||console.log.bind(console,"oops"))(t)}function n(t,e,i){p=p.merge(t,e,i)}function r(){be!=p&&a.useProgram(be=p);for(var e=-1;++e<l.length;){l[e]?a.disable(a.BLEND):a.enable(a.BLEND),a.bindFramebuffer(a.FRAMEBUFFER,l[e]),o(),s(a,t);for(var i=-1;++i<h.length;)h[i].draw()}}function o(){for(var t in ke)be[t]&&be[t](ke[t])}function s(t,e){t.viewport(0,0,e.width,e.height)}var a=t.gl,l=[],p=t.program||be,u=t.types=le(),h=t.mesh?[t.mesh]:V(a,t.types);return h.forEach(function(t){t.mergeProgram=n}),t.__renderTarget__={update:r,append:i,drawTo:e,mergeProgram:n}}function V(t,e){var i=new j(t,{primitive:"points"});i.bind(e.circle),i.bind(e.rect);var n=new j(t,{primitive:"lines",pos:{size:2}});n.bind(e.line);var r=new j(t,{primitive:"triangles",pos:{size:2}});return r.bind(e.path),[r,i,n]}function $(t){var e=Fe.createFramebuffer();return Fe.bindFramebuffer(Fe.FRAMEBUFFER,e),e.width=t.width,e.height=t.height,Fe.framebufferTexture2D(Fe.FRAMEBUFFER,Fe.COLOR_ATTACHMENT0,Fe.TEXTURE_2D,t.texture,null),Fe.bindFramebuffer(Fe.FRAMEBUFFER,null),e}function Q(t){return this.querySelectorAll(t)[0]}function Z(t,e){return t.replace(/^\s+|\s*([,\s\+\~>]|$)\s*/g,"$1").split(",").forEach(function(t){K(t,this).forEach(s.bind(e=[]))},this)||e}function K(t,e){var i,n=t.split(/[\s\>\+\~](?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/),r=t.match(/([\s\>\+\~])(?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/),o=ie(n.pop()),s=[],a=[];return se.call(e,o[1]||"*").forEach(function(t){(i=te.apply(t,o))&&s.push(i)}),n.length?s.forEach(function(t){J(t,n,r)&&a.push(t)})||a:s}function J(t,e,i,n){return n=function r(t,o,s){for(;s=Ge[i[o]](s,t);)if(te.apply(s,ie(e[o]))&&o)return(n=r(s,o-1,s))?n:s}(t,e.length-1,t)}function te(t,e,i,n,r,o,s,t,a,t,l,p){return a&&We[a]&&!We[a](this,l)||e&&"*"!==e&&this.tag&&this.tag.toLowerCase()!==e||n&&!ee(o,(this.attr[r]||"").toString(),s)||i&&(p=i.match(/#([\w\-]+)/))&&p[1]!==this.attr.id||i&&(i.match(/\.[\w\-]+/g)||[]).some(oe.bind(this))?0:this}function ee(t,e,i){return e.toString().match(RegExp({"=":i,"^=":"^"+re(i),"$=":re(i)+"$","*=":re(i),"~=":"(?:^|\\s+)"+re(i)+"(?:\\s+|$)","|=":"^"+re(i)+"(-|$)"}[t]||"adnan^"))}function ie(t){return t.match(Xe)}function ne(t){for(;t=t.previousSibling();)if(t.top)return t}function re(t){return t.replace(/([.*+?\^=!:${}()|\[\]\/\\])/,"\\$1")}function oe(t){return!RegExp("(^|\\s+)"+t.slice(1)+"(\\s+|$)").test(this.attr.class)}function se(t){return ae(this,function(e){return"*"==t||e.tagName==t},[])}function ae(t,e,i){return(t.__scene__||t.children).forEach(function(t){ae(t,e,i),e(t)&&i.push(t)})||i}function le(){return Ye.reduce(function(t,e){return t[e.name]=function i(){var t=Object.create(e.prototype);return d(t,i),t.init(i.mesh.alloc()-1),t.attr={},t},d(e.prototype,je,He[e.name],{tagName:e.name}),t},{})}function pe(t){W.call(this,t),this.fill(this.attr.stroke)}function ue(t,e){var i=canvas.__scene__,n=i.indexOf(e);reverseEach(i.slice(n,i.push(0)),function(t,e){i[e]=i[e-1]}),i[n]=t}function he(t){return this.__scene__[this.__scene__.length]=this.__renderTarget__.append(t.tagName)}function ce(t){var e=this.__scene__.indexOf(t);t=this.__scene__.splice(e,1)[0],t&&t.mesh.free(e)}function fe(t){this.width=t.width||512,this.height=t.height||512,"string"==typeof t&&(t=_e(t)),"number"==typeof t&&(this.width=this.height=Math.sqrt(t),t=!1),d(this,{gl:Fe,id:Le(),data:t,dependents:[],texture:Fe.createTexture(),invalidate:function(){Ce.push(function(){this.forEach(function(t){t.invalidate()})}.bind(this.dependents))}}),Array.isArray(t)&&(this.data=null,xe.call(this,t)),t.constructor==Object&&(t=me(t)),Se.call(this)}function de(){var t=f.call(this),e=Fe[t?"REPEAT":"CLAMP_TO_EDGE"],i=Fe[t?"LINEAR":"NEAREST"];Fe.bindTexture(Fe.TEXTURE_2D,this.texture),Fe.pixelStorei(Fe.UNPACK_FLIP_Y_WEBGL,!0),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_MAG_FILTER,i),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_MIN_FILTER,i),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_WRAP_S,e),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_WRAP_T,e),this.update()}function _e(t){try{var e=document.querySelector(t);if(e)return e}catch(i){}return d(h?new Image:document.createElement("video"),{crossOrigin:"anonymous",src:t})}function ye(t){return this.dependents.push(t),this}function ge(){for(var t=this.size()||0,e=new Array(t);t--;)e[t]={x:this.x()(t,t),y:this.y()(t,t),z:this.z()(t,t)};return e}function ve(){d(this,{__scene__:[]})(this.__renderTarget__=Y(this)).drawTo(this);var t=this.update;this.update=function(){t.call(this),this.__renderTarget__.update()}}function me(t){var e=new Float32Array(1024),i=0;for(var n in t){for(var r in t[n])e[i++]=t[n][r];i>1020&&(this.subImage(0,i,e),e=new Float32Array(1024))}}function Se(){var t=this.data;return de.call(this),this.update(Ie),_(t,this.update.bind(this)),this}function xe(t){var e=this.height,i=this.height,n=[{x:e,y:i,i:0,size:t.length}],r=this;!function o(t){var i=t.x+t.size,r=i-width;width>i||(t.size-=r,n.push(t={x:0,y:(t.y+1)%e,size:r,i:++t.i}),o(t))}(n[0]),n.forEach(function(e){for(var i=[],n=-1;++n<e.size;)i.push(t[e.i]);r.subImage(e.x,e.y,i)})}function Ee(t,e){return Math.random()*(e-t)}var we=this.pathgl={};we.sim={},we.stop=function(){},we.context=function(){return Fe};var Le=function(t){return function(){return t++}}(1),Te=0,Ce=[];we.texture=function(t){return Te||we.init("canvas"),new fe(t||!1)},we.uniform=function(t,e){return 1==arguments.length?ke[t]:ke[t]=e},we.applyCSS=G,HTMLCanvasElement.prototype.appendChild=function(t){return we.init(this)?this.appendChild(t):void 0};var Fe,be,Ae=[],ke={},Pe=Date.now();we.init=function(t){return Te=1,t="string"==typeof t?document.querySelector(t):t instanceof d3.selection?t.node():t,t.getContext?!!A(t):console.log(t,"is not a valid canvas")},t.INIT_SIZE_=32,t.prototype.init=function(){this.order_=[];for(var t=0;t<this.size_;t++)this.order_[t]=t;var e=function(t,e){return function(i,n){return e(t[i],t[n])?1:-1}}(this.keys_,this.leq_);this.order_.sort(e),this.max_=this.size_,this.initialized_=!0,this.heap_.init();var i=0,n=i+this.size_-1;for(t=i;n>t;++t)Ue(this.leq_(this.keys_[this.order_[t+1]],this.keys_[this.order_[t]]))},t.prototype.add=function(e){if(this.initialized_)return this.heap_.add(e);var i=this.size_;return++this.size_>=this.max_&&(this.max_*=2,this.keys_=t.prototype.PQKeyRenew_(this.keys_,this.max_)),this.keys_[i]=e,-(i+1)},t.prototype.PQKeyRenew_=function(t,e){var i=new Array(e),n=0;if(t!==!1)for(;n<t.length;n++)i[n]=t[n];for(;e>n;n++)i[n]=!1;return i},t.prototype.keyLessThan_=function(t,e){var i=this.keys_[t],n=this.keys_[e];return!this.leq_(n,i)},t.prototype.keyGreaterThan_=function(t,e){var i=this.keys_[t],n=this.keys_[e];return!this.leq_(i,n)},t.prototype.findMin=function(){if(0===this.size_)return this.heap_.findMin();var t=this.keys_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var e=this.heap_.minimum();if(this.leq_(e,t))return this.heap_.findMin()}do--this.size_;while(this.size_>0&&this.keys_[this.order_[this.size_-1]]===!1);return t},t.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var t=this.keys_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var e=this.heap_.minimum();if(this.leq_(e,t))return e}return t},t.prototype.isEmpty=function(){return 0===this.size_&&this.heap_.isEmpty()},t.prototype.remove=function(t){if(t>=0)return this.heap_.remove(t);for(t=-(t+1),Ue(t<this.max_&&this.keys_[t]!==!1),this.keys_[t]=!1;this.size_>0&&this.keys_[this.order_[this.size_-1]]===!1;)--this.size_},e.INIT_SIZE_=32,e.prototype.killHeap=function(){this.handles_=!1,this.ns_=!1},e.prototype.init=function(){for(var t=this.size_;t>=1;--t)this.floatDown_(t);this.initialized_=!0},e.prototype.add=function(t){var e,r=++this.size_;return 2*r>this.max_&&(this.max_*=2,this.ns_=i.renew(this.ns_,this.max_+1),this.handles_=n.renew(this.handles_,this.max_+1)),0===this.fList_?e=r:(e=this.fList_,this.fList_=this.handles_[e].n),this.ns_[r].handle=e,this.handles_[e].n=r,this.handles_[e].key=t,this.initialized_&&this.floatUp_(r),e},e.prototype.isEmpty=function(){return 0===this.size_},e.prototype.minimum=function(){return this.handles_[this.ns_[1].handle].key},e.prototype.findMin=function(){var t=this.ns_,e=this.handles_,i=t[1].handle,n=e[i].key;return this.size_>0&&(t[1].handle=t[this.size_].handle,e[t[1].handle].n=1,e[i].key=!1,e[i].n=this.fList_,this.fList_=i,--this.size_>0&&this.floatDown_(1)),n},e.prototype.remove=function(t){var e=this.ns_,i=this.handles_;Ue(t>=1&&t<=this.max_&&i[t].key!==!1);var n=i[t].n;e[n].handle=e[this.size_].handle,i[e[n].handle].n=n,n<=--this.size_&&(1>=n||this.leq_(i[e[n>>1].handle].key,i[e[n].handle].key)?this.floatDown_(n):this.floatUp_(n)),i[t].key=!1,i[t].n=this.fList_,this.fList_=t},e.prototype.floatDown_=function(t){for(var e=this.ns_,i=this.handles_,n=e[t].handle;;){var r=t<<1;r<this.size_&&this.leq_(i[e[r+1].handle].key,i[e[r].handle].key)&&++r,Ue(r<=this.max_);var o=e[r].handle;if(r>this.size_||this.leq_(i[n].key,i[o].key))return e[t].handle=n,i[n].n=t;e[t].handle=o,i[o].n=t,t=r}},e.prototype.floatUp_=function(t){for(var e=this.ns_,i=this.handles_,n=e[t].handle;;){var r=t>>1,o=e[r].handle;if(0===r||this.leq_(i[o].key,i[n].key))return e[t].handle=n,i[n].n=t;e[t].handle=o,i[o].n=t,t=r}},i.renew=function(t,e){var n=new Array(e),r=0;if(t!==!1)for(;r<t.length;r++)n[r]=t[r];for(;e>r;r++)n[r]=new i;return n},n.renew=function(t,e){var i=new Array(e),r=0;if(t!==!1)for(;r<t.length;r++)i[r]=t[r];for(;e>r;r++)i[r]=new n;return i};var Ie=function(){var t,e,i=document.createElement("canvas").getContext("2d"),n=i.canvas.width=i.canvas.height=128;for(t=0;n>t;t+=16)for(e=0;n>e;e+=16)i.fillStyle=16&(e^t)?"#FFF":"#DDD",i.fillRect(e,t,16,16);return i.canvas}(),Ne=Ne||{};Ne.poly2tri=Ne.poly2tri||{},Ne.poly2tri.fatal=function(t){alert(t)},Ne.poly2tri.Point=function(){this.x=null,this.y=null,0==arguments.length?(this.x=0,this.y=0):2==arguments.length?(this.x=arguments[0],this.y=arguments[1]):Ne.poly2tri.fatal("Invalid js.poly2tri.Point constructor call!"),this.edge_list=[]},Ne.poly2tri.Point.prototype.toString=function(){return"("+this.x+";"+this.y+")"},Ne.poly2tri.Point.prototype.set_zero=function(){this.x=0,this.y=0},Ne.poly2tri.Point.prototype.set=function(t,e){this.x=t,this.y=e},Ne.poly2tri.Point.prototype.negate=function(){this.x=-this.x,this.y=-this.y},Ne.poly2tri.Point.prototype.add=function(t){this.x+=t.x,this.y+=t.y},Ne.poly2tri.Point.prototype.sub=function(t){this.x-=t.x,this.y-=t.y},Ne.poly2tri.Point.prototype.mul=function(t){this.x*=t,this.y*=t},Ne.poly2tri.Point.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Ne.poly2tri.Point.prototype.normalize=function(){var t=this.length();return this.x/=t,this.y/=t,t},Ne.poly2tri.Point.prototype.equals=function(t){return Ne.poly2tri.equals(this,t)},Ne.poly2tri.negate=function(t){return new Ne.poly2tri.Point(-t.x,-t.y)},Ne.poly2tri.cmp=function(t,e){return t.y==e.y?t.x-e.x:t.y-e.y},Ne.poly2tri.add=function(t,e){return new Ne.poly2tri.Point(t.x+e.x,t.y+e.y)},Ne.poly2tri.sub=function(t,e){return new Ne.poly2tri.Point(t.x-e.x,t.y-e.y)},Ne.poly2tri.mul=function(t,e){return new Ne.poly2tri.Point(t*e.x,t*e.y)},Ne.poly2tri.equals=function(t,e){return t.x==e.x&&t.y==e.y},Ne.poly2tri.dot=function(t,e){return t.x*e.x+t.y*e.y},Ne.poly2tri.cross=function(){var t=!1,e=!1;return 2==arguments.length?("number"==typeof arguments[0]&&(t=!0),e=!0,t?e?arguments[0].x*arguments[1].y-arguments[0].y*arguments[1].x:new Ne.poly2tri.Point(arguments[1]*arguments[0].y,-arguments[1]*arguments[0].x):e?new Ne.poly2tri.Point(-arguments[0]*arguments[1].y,arguments[0]*arguments[1].x):arguments[0]*arguments[1]):(Ne.poly2tri.fatal("Invalid js.poly2tri.cross call!"),void 0)},Ne.poly2tri.Edge=function(){this.p=null,this.q=null,2==arguments.length?arguments[0].y>arguments[1].y?(this.q=arguments[0],this.p=arguments[1]):arguments[0].y==arguments[1].y?arguments[0].x>arguments[1].x?(this.q=arguments[0],this.p=arguments[1]):arguments[0].x==arguments[1].x?Ne.poly2tri.fatal("Invalid js.poly2tri.edge constructor call: repeated points! "+arguments[0]):(this.p=arguments[0],this.q=arguments[1]):(this.p=arguments[0],this.q=arguments[1]):Ne.poly2tri.fatal("Invalid js.poly2tri.Edge constructor call!"),this.q.edge_list.push(this)},Ne.poly2tri.Triangle=function(t,e,i){this.points_=[null,null,null],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1],3==arguments.length&&(this.points_[0]=t,this.points_[1]=e,this.points_[2]=i)},Ne.poly2tri.Triangle.prototype.toString=function(){return"["+this.points_[0]+this.points_[1]+this.points_[2]+"]"},Ne.poly2tri.Triangle.prototype.GetPoint=function(t){return this.points_[t]},Ne.poly2tri.Triangle.prototype.GetNeighbor=function(t){return this.neighbors_[t]},Ne.poly2tri.Triangle.prototype.ContainsP=function(){for(var t=!0,e=0;e<arguments.length;++e)t=t&&(arguments[e].equals(this.points_[0])||arguments[e].equals(this.points_[1])||arguments[e].equals(this.points_[2]));return t},Ne.poly2tri.Triangle.prototype.ContainsE=function(){for(var t=!0,e=0;e<arguments.length;++e)t=t&&this.ContainsP(arguments[e].p,arguments[e].q);return t},Ne.poly2tri.Triangle.prototype.IsInterior=function(){return 0==arguments.length?this.interior_:(this.interior_=arguments[0],this.interior_)},Ne.poly2tri.Triangle.prototype.MarkNeighbor=function(){var t;if(3==arguments.length){var e=arguments[0],i=arguments[1];t=arguments[2],e.equals(this.points_[2])&&i.equals(this.points_[1])||e.equals(this.points_[1])&&i.equals(this.points_[2])?this.neighbors_[0]=t:e.equals(this.points_[0])&&i.equals(this.points_[2])||e.equals(this.points_[2])&&i.equals(this.points_[0])?this.neighbors_[1]=t:e.equals(this.points_[0])&&i.equals(this.points_[1])||e.equals(this.points_[1])&&i.equals(this.points_[0])?this.neighbors_[2]=t:Ne.poly2tri.fatal("Invalid js.poly2tri.Triangle.MarkNeighbor call (1)!")}else 1==arguments.length?(t=arguments[0],t.ContainsP(this.points_[1],this.points_[2])?(this.neighbors_[0]=t,t.MarkNeighbor(this.points_[1],this.points_[2],this)):t.ContainsP(this.points_[0],this.points_[2])?(this.neighbors_[1]=t,t.MarkNeighbor(this.points_[0],this.points_[2],this)):t.ContainsP(this.points_[0],this.points_[1])&&(this.neighbors_[2]=t,t.MarkNeighbor(this.points_[0],this.points_[1],this))):Ne.poly2tri.fatal("Invalid js.poly2tri.Triangle.MarkNeighbor call! (2)")},Ne.poly2tri.Triangle.prototype.ClearNeigbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},Ne.poly2tri.Triangle.prototype.ClearDelunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},Ne.poly2tri.Triangle.prototype.PointCW=function(t){return t.equals(this.points_[0])?this.points_[2]:t.equals(this.points_[1])?this.points_[0]:t.equals(this.points_[2])?this.points_[1]:null},Ne.poly2tri.Triangle.prototype.PointCCW=function(t){return t.equals(this.points_[0])?this.points_[1]:t.equals(this.points_[1])?this.points_[2]:t.equals(this.points_[2])?this.points_[0]:null},Ne.poly2tri.Triangle.prototype.NeighborCW=function(t){return t.equals(this.points_[0])?this.neighbors_[1]:t.equals(this.points_[1])?this.neighbors_[2]:this.neighbors_[0]},Ne.poly2tri.Triangle.prototype.NeighborCCW=function(t){return t.equals(this.points_[0])?this.neighbors_[2]:t.equals(this.points_[1])?this.neighbors_[0]:this.neighbors_[1]},Ne.poly2tri.Triangle.prototype.GetConstrainedEdgeCW=function(t){return t.equals(this.points_[0])?this.constrained_edge[1]:t.equals(this.points_[1])?this.constrained_edge[2]:this.constrained_edge[0]},Ne.poly2tri.Triangle.prototype.GetConstrainedEdgeCCW=function(t){return t.equals(this.points_[0])?this.constrained_edge[2]:t.equals(this.points_[1])?this.constrained_edge[0]:this.constrained_edge[1]},Ne.poly2tri.Triangle.prototype.SetConstrainedEdgeCW=function(t,e){t.equals(this.points_[0])?this.constrained_edge[1]=e:t.equals(this.points_[1])?this.constrained_edge[2]=e:this.constrained_edge[0]=e},Ne.poly2tri.Triangle.prototype.SetConstrainedEdgeCCW=function(t,e){t.equals(this.points_[0])?this.constrained_edge[2]=e:t.equals(this.points_[1])?this.constrained_edge[0]=e:this.constrained_edge[1]=e},Ne.poly2tri.Triangle.prototype.GetDelaunayEdgeCW=function(t){return t.equals(this.points_[0])?this.delaunay_edge[1]:t.equals(this.points_[1])?this.delaunay_edge[2]:this.delaunay_edge[0]},Ne.poly2tri.Triangle.prototype.GetDelaunayEdgeCCW=function(t){return t.equals(this.points_[0])?this.delaunay_edge[2]:t.equals(this.points_[1])?this.delaunay_edge[0]:this.delaunay_edge[1]},Ne.poly2tri.Triangle.prototype.SetDelaunayEdgeCW=function(t,e){t.equals(this.points_[0])?this.delaunay_edge[1]=e:t.equals(this.points_[1])?this.delaunay_edge[2]=e:this.delaunay_edge[0]=e},Ne.poly2tri.Triangle.prototype.SetDelaunayEdgeCCW=function(t,e){t.equals(this.points_[0])?this.delaunay_edge[2]=e:t.equals(this.points_[1])?this.delaunay_edge[0]=e:this.delaunay_edge[1]=e},Ne.poly2tri.Triangle.prototype.NeighborAcross=function(t){return t.equals(this.points_[0])?this.neighbors_[0]:t.equals(this.points_[1])?this.neighbors_[1]:this.neighbors_[2]},Ne.poly2tri.Triangle.prototype.OppositePoint=function(t,e){var i=t.PointCW(e);return this.PointCW(i)},Ne.poly2tri.Triangle.prototype.Legalize=function(){if(1==arguments.length)this.Legalize(this.points_[0],arguments[0]);else if(2==arguments.length){var t=arguments[0],e=arguments[1];t.equals(this.points_[0])?(this.points_[1]=this.points_[0],this.points_[0]=this.points_[2],this.points_[2]=e):t.equals(this.points_[1])?(this.points_[2]=this.points_[1],this.points_[1]=this.points_[0],this.points_[0]=e):t.equals(this.points_[2])?(this.points_[0]=this.points_[2],this.points_[2]=this.points_[1],this.points_[1]=e):Ne.poly2tri.fatal("Invalid js.poly2tri.Triangle.Legalize call!")}else Ne.poly2tri.fatal("Invalid js.poly2tri.Triangle.Legalize call!")},Ne.poly2tri.Triangle.prototype.Index=function(t){return t.equals(this.points_[0])?0:t.equals(this.points_[1])?1:t.equals(this.points_[2])?2:-1},Ne.poly2tri.Triangle.prototype.EdgeIndex=function(t,e){if(t.equals(this.points_[0])){if(e.equals(this.points_[1]))return 2;if(e.equals(this.points_[2]))return 1}else if(t.equals(this.points_[1])){if(e.equals(this.points_[2]))return 0;if(e.equals(this.points_[0]))return 2}else if(t.equals(this.points_[2])){if(e.equals(this.points_[0]))return 1;if(e.equals(this.points_[1]))return 0}return-1},Ne.poly2tri.Triangle.prototype.MarkConstrainedEdge=function(){if(1==arguments.length)"number"==typeof arguments[0]?this.constrained_edge[arguments[0]]=!0:this.MarkConstrainedEdge(arguments[0].p,arguments[0].q);else if(2==arguments.length){var t=arguments[0],e=arguments[1];e.equals(this.points_[0])&&t.equals(this.points_[1])||e.equals(this.points_[1])&&t.equals(this.points_[0])?this.constrained_edge[2]=!0:e.equals(this.points_[0])&&t.equals(this.points_[2])||e.equals(this.points_[2])&&t.equals(this.points_[0])?this.constrained_edge[1]=!0:(e.equals(this.points_[1])&&t.equals(this.points_[2])||e.equals(this.points_[2])&&t.equals(this.points_[1]))&&(this.constrained_edge[0]=!0)}else Ne.poly2tri.fatal("Invalid js.poly2tri.Triangle.MarkConstrainedEdge call!")},Ne.poly2tri.PI_3div4=3*Math.PI/4,Ne.poly2tri.PI_2=Math.PI/2,Ne.poly2tri.EPSILON=1e-12,Ne.poly2tri.kAlpha=.3,Ne.poly2tri.Orientation={CW:1,CCW:-1,COLLINEAR:0},Ne.poly2tri.Orient2d=function(t,e,i){var n=(t.x-i.x)*(e.y-i.y),r=(t.y-i.y)*(e.x-i.x),o=n-r;return o>-Ne.poly2tri.EPSILON&&o<Ne.poly2tri.EPSILON?Ne.poly2tri.Orientation.COLLINEAR:o>0?Ne.poly2tri.Orientation.CCW:Ne.poly2tri.Orientation.CW},Ne.poly2tri.InScanArea=function(t,e,i,n){var r=n.x,o=n.y,s=t.x-r,a=t.y-o,l=e.x-r,p=e.y-o,u=s*p,h=l*a,c=u-h;if(c<=Ne.poly2tri.EPSILON)return!1;var f=i.x-r,d=i.y-o,_=f*a,y=s*d,g=_-y;return g<=Ne.poly2tri.EPSILON?!1:!0},Ne.poly2tri.Node=function(){this.point=null,this.triangle=null,this.next=null,this.prev=null,this.value=0,1==arguments.length?(this.point=arguments[0],this.value=this.point.x):2==arguments.length?(this.point=arguments[0],this.triangle=arguments[1],this.value=this.point.x):Ne.poly2tri.fatal("Invalid js.poly2tri.Node constructor call!")},Ne.poly2tri.AdvancingFront=function(t,e){this.head_=t,this.tail_=e,this.search_node_=t},Ne.poly2tri.AdvancingFront.prototype.head=function(){return this.head_},Ne.poly2tri.AdvancingFront.prototype.set_head=function(t){this.head_=t},Ne.poly2tri.AdvancingFront.prototype.tail=function(){return this.tail_},Ne.poly2tri.AdvancingFront.prototype.set_tail=function(t){this.tail_=t},Ne.poly2tri.AdvancingFront.prototype.search=function(){return this.search_node_},Ne.poly2tri.AdvancingFront.prototype.set_search=function(t){this.search_node_=t},Ne.poly2tri.AdvancingFront.prototype.FindSearchNode=function(){return this.search_node_},Ne.poly2tri.AdvancingFront.prototype.LocateNode=function(t){var e=this.search_node_;if(t<e.value){for(;null!=(e=e.prev);)if(t>=e.value)return this.search_node_=e,e}else for(;null!=(e=e.next);)if(t<e.value)return this.search_node_=e.prev,e.prev;return null},Ne.poly2tri.AdvancingFront.prototype.LocatePoint=function(t){var e=t.x,i=this.FindSearchNode(e),n=i.point.x;if(e==n){if(i.prev&&t.equals(i.prev.point))i=i.prev;else if(i.next&&t.equals(i.next.point))i=i.next;else if(!t.equals(i.point))return Ne.poly2tri.fatal("Invalid js.poly2tri.AdvancingFront.LocatePoint call!"),null}else if(n>e)for(;null!=(i=i.prev)&&!t.equals(i.point););else for(;null!=(i=i.next)&&!t.equals(i.point););return null!=i&&(this.search_node_=i),i},Ne.poly2tri.Basin=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1},Ne.poly2tri.Basin.prototype.Clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1},Ne.poly2tri.EdgeEvent=function(){this.constrained_edge=null,this.right=!1},Ne.poly2tri.SweepContext=function(t){this.triangles_=[],this.map_=[],this.points_=t,this.edge_list=[],this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new Ne.poly2tri.Basin,this.edge_event=new Ne.poly2tri.EdgeEvent,this.InitEdges(this.points_)},Ne.poly2tri.SweepContext.prototype.AddHole=function(t){this.InitEdges(t);for(var e in t)this.points_.push(t[e])},Ne.poly2tri.SweepContext.prototype.AddPoint=function(t){this.points_.push(t)
},Ne.poly2tri.SweepContext.prototype.front=function(){return this.front_},Ne.poly2tri.SweepContext.prototype.point_count=function(){return this.points_.length},Ne.poly2tri.SweepContext.prototype.head=function(){return this.head_},Ne.poly2tri.SweepContext.prototype.set_head=function(t){this.head_=t},Ne.poly2tri.SweepContext.prototype.tail=function(){return this.tail_},Ne.poly2tri.SweepContext.prototype.set_tail=function(t){this.tail_=t},Ne.poly2tri.SweepContext.prototype.GetTriangles=function(){return this.triangles_},Ne.poly2tri.SweepContext.prototype.GetMap=function(){return this.map_},Ne.poly2tri.SweepContext.prototype.InitTriangulation=function(){var t=this.points_[0].x,e=this.points_[0].x,i=this.points_[0].y,n=this.points_[0].y;for(var r in this.points_){var o=this.points_[r];o.x>t&&(t=o.x),o.x<e&&(e=o.x),o.y>i&&(i=o.y),o.y<n&&(n=o.y)}var s=Ne.poly2tri.kAlpha*(t-e),a=Ne.poly2tri.kAlpha*(i-n);this.head_=new Ne.poly2tri.Point(t+s,n-a),this.tail_=new Ne.poly2tri.Point(e-a,n-a),this.points_.sort(Ne.poly2tri.cmp)},Ne.poly2tri.SweepContext.prototype.InitEdges=function(t){for(var e=0;e<t.length;++e)this.edge_list.push(new Ne.poly2tri.Edge(t[e],t[(e+1)%t.length]))},Ne.poly2tri.SweepContext.prototype.GetPoint=function(t){return this.points_[t]},Ne.poly2tri.SweepContext.prototype.AddToMap=function(t){this.map_.push(t)},Ne.poly2tri.SweepContext.prototype.LocateNode=function(t){return this.front_.LocateNode(t.x)},Ne.poly2tri.SweepContext.prototype.CreateAdvancingFront=function(){var t,e,i,n=new Ne.poly2tri.Triangle(this.points_[0],this.tail_,this.head_);this.map_.push(n),t=new Ne.poly2tri.Node(n.GetPoint(1),n),e=new Ne.poly2tri.Node(n.GetPoint(0),n),i=new Ne.poly2tri.Node(n.GetPoint(2)),this.front_=new Ne.poly2tri.AdvancingFront(t,i),t.next=e,e.next=i,e.prev=t,i.prev=e},Ne.poly2tri.SweepContext.prototype.RemoveNode=function(){},Ne.poly2tri.SweepContext.prototype.MapTriangleToNodes=function(t){for(var e=0;3>e;++e)if(null==t.GetNeighbor(e)){var i=this.front_.LocatePoint(t.PointCW(t.GetPoint(e)));null!=i&&(i.triangle=t)}},Ne.poly2tri.SweepContext.prototype.RemoveFromMap=function(t){for(var e in this.map_)if(this.map_[e]==t){delete this.map_[e];break}},Ne.poly2tri.SweepContext.prototype.MeshClean=function(t){for(var e,i,n=[t];e=n.pop();)if(!e.IsInterior())for(e.IsInterior(!0),this.triangles_.push(e),i=0;3>i;i++)e.constrained_edge[i]||n.push(e.GetNeighbor(i))},"function"==typeof Namespace?Namespace("js.poly2tri.sweep"):Ne.poly2tri.sweep=Ne.poly2tri.sweep||{},Ne.poly2tri.sweep.Triangulate=function(t){t.InitTriangulation(),t.CreateAdvancingFront(),Ne.poly2tri.sweep.SweepPoints(t),Ne.poly2tri.sweep.FinalizationPolygon(t)},Ne.poly2tri.sweep.SweepPoints=function(t){for(var e=1;e<t.point_count();++e)for(var i=t.GetPoint(e),n=Ne.poly2tri.sweep.PointEvent(t,i),r=0;r<i.edge_list.length;++r)Ne.poly2tri.sweep.EdgeEvent(t,i.edge_list[r],n)},Ne.poly2tri.sweep.FinalizationPolygon=function(t){for(var e=t.front().head().next.triangle,i=t.front().head().next.point;!e.GetConstrainedEdgeCW(i);)e=e.NeighborCCW(i);t.MeshClean(e)},Ne.poly2tri.sweep.PointEvent=function(t,e){var i=t.LocateNode(e),n=Ne.poly2tri.sweep.NewFrontTriangle(t,e,i);return e.x<=i.point.x+Ne.poly2tri.EPSILON&&Ne.poly2tri.sweep.Fill(t,i),Ne.poly2tri.sweep.FillAdvancingFront(t,n),n},Ne.poly2tri.sweep.EdgeEvent=function(){var t;if(3==arguments.length){t=arguments[0];var e=arguments[1],i=arguments[2];if(t.edge_event.constrained_edge=e,t.edge_event.right=e.p.x>e.q.x,Ne.poly2tri.sweep.IsEdgeSideOfTriangle(i.triangle,e.p,e.q))return;Ne.poly2tri.sweep.FillEdgeEvent(t,e,i),Ne.poly2tri.sweep.EdgeEvent(t,e.p,e.q,i.triangle,e.q)}else if(5==arguments.length){t=arguments[0];var n=arguments[1],r=arguments[2],o=arguments[3],s=arguments[4];if(Ne.poly2tri.sweep.IsEdgeSideOfTriangle(o,n,r))return;var a=o.PointCCW(s),l=Ne.poly2tri.Orient2d(r,a,n);if(l==Ne.poly2tri.Orientation.COLLINEAR)return Ne.poly2tri.fatal("js.poly2tri.sweep.EdgeEvent: Collinear not supported! "+r+a+n),void 0;var p=o.PointCW(s),u=Ne.poly2tri.Orient2d(r,p,n);if(u==Ne.poly2tri.Orientation.COLLINEAR)return Ne.poly2tri.fatal("js.poly2tri.sweep.EdgeEvent: Collinear not supported! "+r+p+n),void 0;l==u?(o=l==Ne.poly2tri.Orientation.CW?o.NeighborCCW(s):o.NeighborCW(s),Ne.poly2tri.sweep.EdgeEvent(t,n,r,o,s)):Ne.poly2tri.sweep.FlipEdgeEvent(t,n,r,o,s)}else Ne.poly2tri.fatal("Invalid js.poly2tri.sweep.EdgeEvent call!")},Ne.poly2tri.sweep.IsEdgeSideOfTriangle=function(t,e,i){var n=t.EdgeIndex(e,i);if(-1!=n){t.MarkConstrainedEdge(n);var r=t.GetNeighbor(n);return null!=r&&r.MarkConstrainedEdge(e,i),!0}return!1},Ne.poly2tri.sweep.NewFrontTriangle=function(t,e,i){var n=new Ne.poly2tri.Triangle(e,i.point,i.next.point);n.MarkNeighbor(i.triangle),t.AddToMap(n);var r=new Ne.poly2tri.Node(e);return r.next=i.next,r.prev=i,i.next.prev=r,i.next=r,Ne.poly2tri.sweep.Legalize(t,n)||t.MapTriangleToNodes(n),r},Ne.poly2tri.sweep.Fill=function(t,e){var i=new Ne.poly2tri.Triangle(e.prev.point,e.point,e.next.point);i.MarkNeighbor(e.prev.triangle),i.MarkNeighbor(e.triangle),t.AddToMap(i),e.prev.next=e.next,e.next.prev=e.prev,Ne.poly2tri.sweep.Legalize(t,i)||t.MapTriangleToNodes(i)},Ne.poly2tri.sweep.FillAdvancingFront=function(t,e){for(var i,n=e.next;null!=n.next&&(i=Ne.poly2tri.sweep.HoleAngle(n),!(i>Ne.poly2tri.PI_2||i<-Ne.poly2tri.PI_2));)Ne.poly2tri.sweep.Fill(t,n),n=n.next;for(n=e.prev;null!=n.prev&&(i=Ne.poly2tri.sweep.HoleAngle(n),!(i>Ne.poly2tri.PI_2||i<-Ne.poly2tri.PI_2));)Ne.poly2tri.sweep.Fill(t,n),n=n.prev;null!=e.next&&null!=e.next.next&&(i=Ne.poly2tri.sweep.BasinAngle(e),i<Ne.poly2tri.PI_3div4&&Ne.poly2tri.sweep.FillBasin(t,e))},Ne.poly2tri.sweep.BasinAngle=function(t){var e=t.point.x-t.next.next.point.x,i=t.point.y-t.next.next.point.y;return Math.atan2(i,e)},Ne.poly2tri.sweep.HoleAngle=function(t){var e=t.next.point.x-t.point.x,i=t.next.point.y-t.point.y,n=t.prev.point.x-t.point.x,r=t.prev.point.y-t.point.y;return Math.atan2(e*r-i*n,e*n+i*r)},Ne.poly2tri.sweep.Legalize=function(t,e){for(var i=0;3>i;++i)if(!e.delaunay_edge[i]){var n=e.GetNeighbor(i);if(null!=n){var r=e.GetPoint(i),o=n.OppositePoint(e,r),s=n.Index(o);if(n.constrained_edge[s]||n.delaunay_edge[s]){e.constrained_edge[i]=n.constrained_edge[s];continue}var a=Ne.poly2tri.sweep.Incircle(r,e.PointCCW(r),e.PointCW(r),o);if(a){e.delaunay_edge[i]=!0,n.delaunay_edge[s]=!0,Ne.poly2tri.sweep.RotateTrianglePair(e,r,n,o);var l=!Ne.poly2tri.sweep.Legalize(t,e);return l&&t.MapTriangleToNodes(e),l=!Ne.poly2tri.sweep.Legalize(t,n),l&&t.MapTriangleToNodes(n),e.delaunay_edge[i]=!1,n.delaunay_edge[s]=!1,!0}}}return!1},Ne.poly2tri.sweep.Incircle=function(t,e,i,n){var r=t.x-n.x,o=t.y-n.y,s=e.x-n.x,a=e.y-n.y,l=r*a,p=s*o,u=l-p;if(0>=u)return!1;var h=i.x-n.x,c=i.y-n.y,f=h*o,d=r*c,_=f-d;if(0>=_)return!1;var y=s*c,g=h*a,v=r*r+o*o,m=s*s+a*a,S=h*h+c*c,x=v*(y-g)+m*_+S*u;return x>0},Ne.poly2tri.sweep.RotateTrianglePair=function(t,e,i,n){var r,o,s,a;r=t.NeighborCCW(e),o=t.NeighborCW(e),s=i.NeighborCCW(n),a=i.NeighborCW(n);var l,p,u,h;l=t.GetConstrainedEdgeCCW(e),p=t.GetConstrainedEdgeCW(e),u=i.GetConstrainedEdgeCCW(n),h=i.GetConstrainedEdgeCW(n);var c,f,d,_;c=t.GetDelaunayEdgeCCW(e),f=t.GetDelaunayEdgeCW(e),d=i.GetDelaunayEdgeCCW(n),_=i.GetDelaunayEdgeCW(n),t.Legalize(e,n),i.Legalize(n,e),i.SetDelaunayEdgeCCW(e,c),t.SetDelaunayEdgeCW(e,f),t.SetDelaunayEdgeCCW(n,d),i.SetDelaunayEdgeCW(n,_),i.SetConstrainedEdgeCCW(e,l),t.SetConstrainedEdgeCW(e,p),t.SetConstrainedEdgeCCW(n,u),i.SetConstrainedEdgeCW(n,h),t.ClearNeigbors(),i.ClearNeigbors(),r&&i.MarkNeighbor(r),o&&t.MarkNeighbor(o),s&&t.MarkNeighbor(s),a&&i.MarkNeighbor(a),t.MarkNeighbor(i)},Ne.poly2tri.sweep.FillBasin=function(t,e){for(t.basin.left_node=Ne.poly2tri.Orient2d(e.point,e.next.point,e.next.next.point)==Ne.poly2tri.Orientation.CCW?e.next.next:e.next,t.basin.bottom_node=t.basin.left_node;null!=t.basin.bottom_node.next&&t.basin.bottom_node.point.y>=t.basin.bottom_node.next.point.y;)t.basin.bottom_node=t.basin.bottom_node.next;if(t.basin.bottom_node!=t.basin.left_node){for(t.basin.right_node=t.basin.bottom_node;null!=t.basin.right_node.next&&t.basin.right_node.point.y<t.basin.right_node.next.point.y;)t.basin.right_node=t.basin.right_node.next;t.basin.right_node!=t.basin.bottom_node&&(t.basin.width=t.basin.right_node.point.x-t.basin.left_node.point.x,t.basin.left_highest=t.basin.left_node.point.y>t.basin.right_node.point.y,Ne.poly2tri.sweep.FillBasinReq(t,t.basin.bottom_node))}},Ne.poly2tri.sweep.FillBasinReq=function(t,e){if(!Ne.poly2tri.sweep.IsShallow(t,e)){Ne.poly2tri.sweep.Fill(t,e);var i;if(e.prev!=t.basin.left_node||e.next!=t.basin.right_node){if(e.prev==t.basin.left_node){if(i=Ne.poly2tri.Orient2d(e.point,e.next.point,e.next.next.point),i==Ne.poly2tri.Orientation.CW)return;e=e.next}else if(e.next==t.basin.right_node){if(i=Ne.poly2tri.Orient2d(e.point,e.prev.point,e.prev.prev.point),i==Ne.poly2tri.Orientation.CCW)return;e=e.prev}else e=e.prev.point.y<e.next.point.y?e.prev:e.next;Ne.poly2tri.sweep.FillBasinReq(t,e)}}},Ne.poly2tri.sweep.IsShallow=function(t,e){var i;return i=t.basin.left_highest?t.basin.left_node.point.y-e.point.y:t.basin.right_node.point.y-e.point.y,t.basin.width>i?!0:!1},Ne.poly2tri.sweep.FillEdgeEvent=function(t,e,i){t.edge_event.right?Ne.poly2tri.sweep.FillRightAboveEdgeEvent(t,e,i):Ne.poly2tri.sweep.FillLeftAboveEdgeEvent(t,e,i)},Ne.poly2tri.sweep.FillRightAboveEdgeEvent=function(t,e,i){for(;i.next.point.x<e.p.x;)Ne.poly2tri.Orient2d(e.q,i.next.point,e.p)==Ne.poly2tri.Orientation.CCW?Ne.poly2tri.sweep.FillRightBelowEdgeEvent(t,e,i):i=i.next},Ne.poly2tri.sweep.FillRightBelowEdgeEvent=function(t,e,i){i.point.x<e.p.x&&(Ne.poly2tri.Orient2d(i.point,i.next.point,i.next.next.point)==Ne.poly2tri.Orientation.CCW?Ne.poly2tri.sweep.FillRightConcaveEdgeEvent(t,e,i):(Ne.poly2tri.sweep.FillRightConvexEdgeEvent(t,e,i),Ne.poly2tri.sweep.FillRightBelowEdgeEvent(t,e,i)))},Ne.poly2tri.sweep.FillRightConcaveEdgeEvent=function(t,e,i){Ne.poly2tri.sweep.Fill(t,i.next),i.next.point!=e.p&&Ne.poly2tri.Orient2d(e.q,i.next.point,e.p)==Ne.poly2tri.Orientation.CCW&&Ne.poly2tri.Orient2d(i.point,i.next.point,i.next.next.point)==Ne.poly2tri.Orientation.CCW&&Ne.poly2tri.sweep.FillRightConcaveEdgeEvent(t,e,i)},Ne.poly2tri.sweep.FillRightConvexEdgeEvent=function(t,e,i){Ne.poly2tri.Orient2d(i.next.point,i.next.next.point,i.next.next.next.point)==Ne.poly2tri.Orientation.CCW?Ne.poly2tri.sweep.FillRightConcaveEdgeEvent(t,e,i.next):Ne.poly2tri.Orient2d(e.q,i.next.next.point,e.p)==Ne.poly2tri.Orientation.CCW&&Ne.poly2tri.sweep.FillRightConvexEdgeEvent(t,e,i.next)},Ne.poly2tri.sweep.FillLeftAboveEdgeEvent=function(t,e,i){for(;i.prev.point.x>e.p.x;)Ne.poly2tri.Orient2d(e.q,i.prev.point,e.p)==Ne.poly2tri.Orientation.CW?Ne.poly2tri.sweep.FillLeftBelowEdgeEvent(t,e,i):i=i.prev},Ne.poly2tri.sweep.FillLeftBelowEdgeEvent=function(t,e,i){i.point.x>e.p.x&&(Ne.poly2tri.Orient2d(i.point,i.prev.point,i.prev.prev.point)==Ne.poly2tri.Orientation.CW?Ne.poly2tri.sweep.FillLeftConcaveEdgeEvent(t,e,i):(Ne.poly2tri.sweep.FillLeftConvexEdgeEvent(t,e,i),Ne.poly2tri.sweep.FillLeftBelowEdgeEvent(t,e,i)))},Ne.poly2tri.sweep.FillLeftConvexEdgeEvent=function(t,e,i){Ne.poly2tri.Orient2d(i.prev.point,i.prev.prev.point,i.prev.prev.prev.point)==Ne.poly2tri.Orientation.CW?Ne.poly2tri.sweep.FillLeftConcaveEdgeEvent(t,e,i.prev):Ne.poly2tri.Orient2d(e.q,i.prev.prev.point,e.p)==Ne.poly2tri.Orientation.CW&&Ne.poly2tri.sweep.FillLeftConvexEdgeEvent(t,e,i.prev)},Ne.poly2tri.sweep.FillLeftConcaveEdgeEvent=function(t,e,i){Ne.poly2tri.sweep.Fill(t,i.prev),i.prev.point!=e.p&&Ne.poly2tri.Orient2d(e.q,i.prev.point,e.p)==Ne.poly2tri.Orientation.CW&&Ne.poly2tri.Orient2d(i.point,i.prev.point,i.prev.prev.point)==Ne.poly2tri.Orientation.CW&&Ne.poly2tri.sweep.FillLeftConcaveEdgeEvent(t,e,i)},Ne.poly2tri.sweep.FlipEdgeEvent=function(t,e,i,n,r){var o=n.NeighborAcross(r);if(null==o)return Ne.poly2tri.fatal("[BUG:FIXME] FLIP failed due to missing triangle!"),void 0;var s=o.OppositePoint(n,r);if(Ne.poly2tri.InScanArea(r,n.PointCCW(r),n.PointCW(r),s))if(Ne.poly2tri.sweep.RotateTrianglePair(n,r,o,s),t.MapTriangleToNodes(n),t.MapTriangleToNodes(o),r==i&&s==e)i==t.edge_event.constrained_edge.q&&e==t.edge_event.constrained_edge.p&&(n.MarkConstrainedEdge(e,i),o.MarkConstrainedEdge(e,i),Ne.poly2tri.sweep.Legalize(t,n),Ne.poly2tri.sweep.Legalize(t,o));else{var a=Ne.poly2tri.Orient2d(i,s,e);n=Ne.poly2tri.sweep.NextFlipTriangle(t,a,n,o,r,s),Ne.poly2tri.sweep.FlipEdgeEvent(t,e,i,n,r)}else{var l=Ne.poly2tri.sweep.NextFlipPoint(e,i,o,s);Ne.poly2tri.sweep.FlipScanEdgeEvent(t,e,i,n,o,l),Ne.poly2tri.sweep.EdgeEvent(t,e,i,n,r)}},Ne.poly2tri.sweep.NextFlipTriangle=function(t,e,i,n,r,o){var s;return e==Ne.poly2tri.Orientation.CCW?(s=n.EdgeIndex(r,o),n.delaunay_edge[s]=!0,Ne.poly2tri.sweep.Legalize(t,n),n.ClearDelunayEdges(),i):(s=i.EdgeIndex(r,o),i.delaunay_edge[s]=!0,Ne.poly2tri.sweep.Legalize(t,i),i.ClearDelunayEdges(),n)},Ne.poly2tri.sweep.NextFlipPoint=function(t,e,i,n){var r=Ne.poly2tri.Orient2d(e,n,t);return r==Ne.poly2tri.Orientation.CW?i.PointCCW(n):r==Ne.poly2tri.Orientation.CCW?i.PointCW(n):(Ne.poly2tri.fatal("[Unsupported] js.poly2tri.sweep.NextFlipPoint: opposing point on constrained edge!"),void 0)},Ne.poly2tri.sweep.FlipScanEdgeEvent=function(t,e,i,n,r,o){var s=r.NeighborAcross(o);if(null==s)return Ne.poly2tri.fatal("[BUG:FIXME] FLIP failed due to missing triangle"),void 0;var a=s.OppositePoint(r,o);if(Ne.poly2tri.InScanArea(i,n.PointCCW(i),n.PointCW(i),a))Ne.poly2tri.sweep.FlipEdgeEvent(t,i,a,s,a);else{var l=Ne.poly2tri.sweep.NextFlipPoint(e,i,s,a);Ne.poly2tri.sweep.FlipScanEdgeEvent(t,e,i,n,s,l)}};var qe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};we.shader=E,we.vertexShader=["uniform float clock;","uniform vec2 mouse;","uniform vec2 resolution;","uniform vec2 dates;","attribute vec4 pos;","attribute vec4 color;","attribute vec4 fugue;","varying float type;","varying vec4 v_stroke;","varying vec4 v_fill;","varying vec4 dim;","uniform sampler2D texture0;","uniform sampler2D texture1;","uniform sampler2D texture2;","uniform sampler2D texture3;","const mat4 modelViewMatrix = mat4(1.);","const mat4 projectionMatrix = mat4(1.);","vec4 unpack_tex(float col) {","    return vec4(mod(col / 1000. / 1000., 1000.),","                mod(col / 1000. , 1000.),","                mod(col, 1000.),","                col);","}","vec4 texel(vec2 get) { return texture2D(texture0, abs(get)); }","vec4 unpack_color(float col) {","    return vec4(mod(col / 256. / 256., 256.),","                mod(col / 256. , 256.),","                mod(col, 256.),","                256. - fugue.y)","                / 256.;","}","vec2 clipspace(vec2 pos) { return vec2(2. * (pos.x / resolution.x) - 1., 1. - ((pos.y / resolution.y) * 2.)); }","void main() {","    float time = clock / 1000.;","    float x = replace_x;","    float y = replace_y;","    float r = replace_r;","    float fill = color.x;","    float stroke = color.x;","    type = fugue.x;","    gl_PointSize =  r;","    v_fill = unpack_color(fill);","    dim = vec4(x, y, r, -r);","    v_stroke = replace_stroke;","    gl_Position = vec4(clipspace(vec2(x, y)),  1., 1.);","}"].join("\n\n"),we.fragmentShader=["uniform sampler2D texture0;","uniform vec2 resolution;","uniform vec2 dates;","varying float type;","varying vec4 v_stroke;","varying vec4 v_fill;","varying vec4 dim;","vec2 clipspace(vec2 pos) { return vec2(2. * (pos.x / resolution.x) - .5, 1. - ((pos.y / resolution.y))); }","void main() {","    float dist = distance(gl_PointCoord, vec2(0.5));","    if (type == 1. && dist > 0.5) discard;","    gl_FragColor = (v_stroke.x < 0.) ? texture2D(texture0, clipspace(dim.xy + (dim.zw * (gl_PointCoord - .5)))) : v_stroke;","}"].join("\n");var Oe={appendChild:he,querySelectorAll:Z,querySelector:function(t){return this.querySelectorAll(t)[0]},removeChild:ce,insertBefore:ue,__scene__:[],__program__:void 0},Me=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},Re=[],Ue=function(t){y(t,"Could not Triangulate...")};B.sweepDebugEvent=function(){},B.MAX_XY=1e150,B.MALA_MAX_STORE=100,B.EPSILON=0,B.S__X_=1,B.S__Y_=0,B.SIGN_INCONSISTENT_=2,B.cond={T_SLEEP:0,T_IN_SHAPE:1,T_IN_CURVE:2},B.command={COMM_ODD:100130,COMM_NONZERO:100131,COMM_POSITIVE:100132,COMM_NEGATIVE:100133,COMM_ABS_GEQ_TWO:10013};var ze={LINE_LOOP:2,MALAANGLES:4,MALAANGLE_SMALAP:5,MALAANGLE_FAN:6};B.failureType={MISSING_START_SHAPE:100151,MISSING_END_SHAPE:100153,MISSING_START_CURVE:100152,MISSING_END_CURVE:100154,XY_TOO_BIG:100155,NEED_COMBINE_BACK:100156},B.opt={SURFACE:100112,EPSILON:100142,COMM_RULE:100140,LINE_ONLY:100141,INVALID_:100900,INVALID_VALUE:100901,START:100100,POINT:100101,END:100102,FAILURE:100103,LINE_FLAG:100104,COMBINE:100105,START_STAT:100106,POINT_STAT:100107,END_STAT:100108,FAILURE_STAT:100109,LINE_FLAG_STAT:100110,COMBINE_STAT:100111},B.storepoint=function(){this.xys=[0,0,0]},B.prototype.Perp=function(t,e,i){this.perp[0]=t,this.perp[1]=e,this.perp[2]=i},B.prototype.on=function(t,e){return e=e||!1,B.opt.START&&(this.Start_=e),t==B.opt.START_STAT&&(this.StartStat_=e),t==B.opt.LINE_FLAG&&(this.flagLine=!!e),t==B.opt.LINE_FLAG_STAT&&(this.flagLine=!!e),t==B.opt.POINT&&(this.point_=e),t==B.opt.POINT_STAT&&(this.pointStat_=e),t==B.opt.END&&(this.End_=e),t==B.opt.END_STAT&&(this.EndStat_=e),t==B.opt.FAILURE&&(this.Failure_=e),t==B.opt.FAILURE_STAT&&(this.FailureStat_=e),t==B.opt.COMBINE&&(this.Combine_=e),t==B.opt.COMBINE_STAT&&(this.CombineStat_=e),t==B.opt.SURFACE&&(this.layer_=e),this},B.prototype.point=function(t,e){var i=!1,n=[0,0,0];this.requireState_(B.cond.T_IN_CURVE),this.es&&(this.empty_store(),this.lastLine_=!1);for(var r=0;3>r;++r){var o=t[r];o<-B.MAX_XY&&(o=-B.MAX_XY,i=!0),o>B.MAX_XY&&(o=B.MAX_XY,i=!0),n[r]=o}if(i&&this.FailureOrFailureStat(B.failureType.XY_TOO_BIG),this.surface===!1){if(this.storeCount<B.MALA_MAX_STORE)return this.sp(n,e);this.empty_store()}this.addpoint_(n,e)},B.prototype.StartShape=function(t){this.requireState_(B.cond.T_SLEEP),this.state=B.cond.T_IN_SHAPE,this.storeCount=0,this.es=!1,this.surface=!1,this.shapeStat_=t},B.prototype.StartCurve=function(){this.requireState_(B.cond.T_IN_SHAPE),this.state=B.cond.T_IN_CURVE,this.lastLine_=!1,this.storeCount>0&&(this.es=!0)},B.prototype.EndCurve=function(){this.requireState_(B.cond.T_IN_CURVE),this.state=B.cond.T_IN_SHAPE},B.prototype.EndShape=function(){if(this.requireState_(B.cond.T_IN_SHAPE),this.state=B.cond.T_SLEEP,this.surface===!1){if(!this.flagLine&&!this.layer_&&B.drawStore(this))return this.shapeStat_=!1;this.empty_store()}return B.projectShape(this),B.computeInner(this),!this.fatalFailure&&(this.lineOnly?B.FollowId(this.surface,1,!0):B.patchInner(this.surface),this.surface.fixlayer(),(this.Start_||this.End_||this.point_||this.LineFlag_||this.StartStat_||this.EndStat_||this.pointStat_||this.LineFlagStat_)&&(this.lineOnly?B.drawLine(this,this.surface):B.drawlayer(this,this.surface)),this.layer_)?(B.discardOuter(this.surface),this.layer_(this.surface),this.surface=!1,this.shapeStat_=!1):(B.surface.killlayer(this.surface),this.shapeStat_=!1,this.surface=!1,void 0)},B.prototype.makeSleep_=function(){this.surface&&B.surface.killlayer(this.surface),this.state=B.cond.T_SLEEP,this.lastLine_=!1,this.surface=!1},B.prototype.requireState_=function(t){this.state!==t&&this.gotoState_(t)},B.prototype.gotoState_=function(t){for(;this.state!==t;)if(this.state<t)switch(this.state){case B.cond.T_SLEEP:return this.FailureOrFailureStat(B.failureType.MISSING_START_SHAPE),this.StartShape(!1);case B.cond.T_IN_SHAPE:return this.FailureOrFailureStat(B.failureType.MISSING_START_CURVE),this.StartCurve()}else switch(this.state){case B.cond.T_IN_CURVE:return this.FailureOrFailureStat(B.failureType.MISSING_END_CURVE),this.EndCurve();case B.cond.T_IN_SHAPE:return this.FailureOrFailureStat(B.failureType.MISSING_END_SHAPE),this.makeSleep_()}},B.prototype.addpoint_=function(t,e){var i=this.lastLine_;i===!1?(i=B.surface.makeLine(this.surface),B.surface.surfaceSplit(i,i.sym)):(B.surface.splitLine(i),i=i.lThere),i.org.stat=e,i.org.xys[0]=t[0],i.org.xys[1]=t[1],i.org.xys[2]=t[2],i.follow=1,i.sym.follow=-1,this.lastLine_=i},B.prototype.sp=function(t,e){var i=this.store[this.storeCount];i.stat=e,i.xys[0]=t[0],i.xys[1]=t[1],i.xys[2]=t[2],++this.storeCount},B.prototype.empty_store=function(){this.surface=new B.layer;for(var t=0;t<this.storeCount;t++){var e=this.store[t];this.addpoint_(e.xys,e.stat)}this.storeCount=0,this.es=!1},B.prototype.StartOrStartStat=function(t){this.StartStat_?this.StartStat_(t,this.shapeStat_):this.Start_&&this.Start_(t)},B.prototype.pointOrpointStat=function(t){this.pointStat_?this.pointStat_(t,this.shapeStat_):this.point_&&this.point_(t)},B.prototype.LineFlagOrLineFlagStat=function(t){this.LineFlagStat_?this.LineFlagStat_(t,this.shapeStat_):this.LineFlag_&&this.LineFlag_(t)},B.prototype.EndOrEndStat=function(){this.EndStat_?this.EndStat_(this.shapeStat_):this.End_&&this.End_()},B.prototype.CombineOrCombineStat=function(t,e,i){var n=this.CombineStat_?this.CombineStat_(t,e,i,this.shapeStat_):this.Combine_(t,e,i);return void 0===n?n=!1:n},B.prototype.FailureOrFailureStat=function(t){this.FailureStat_?this.FailureStat_(t,this.shapeStat_):this.Failure_&&this.Failure_(t)},B.DictN=function(){this.key=!1,this.there=!1,this.prev=!1},B.Dict=function(t,e){this.start=new B.DictN,this.start.there=this.start,this.start.prev=this.start,this.frame=t,this.leq_=e},B.Dict.prototype.addBefore=function(t,e){do t=t.prev;while(t.key!==!1&&!this.leq_(this.frame,t.key,e));var i=new B.DictN;return i.key=e,i.there=t.there,t.there.prev=i,i.prev=t,t.there=i,i},B.Dict.prototype.add=function(t){return this.addBefore(this.start,t)},B.Dict.prototype.killN=function(t){t.there.prev=t.prev,t.prev.there=t.there},B.Dict.prototype.search=function(t){var e=this.start;do e=e.there;while(e.key!==!1&&!this.leq_(this.frame,t,e.key));return e},B.PQN=function(){this.handle=0},B.PQN.renew=function(t,e){var i=new Array(e),n=0;if(t!==!1)for(;n<t.length;n++)i[n]=t[n];for(;e>n;n++)i[n]=new B.PQN;return i},B.PQHandleElem=function(){this.key=!1,this.n=0},B.PQHandleElem.renew=function(t,e){var i=new Array(e),n=0;if(t!==!1)for(;n<t.length;n++)i[n]=t[n];for(;e>n;n++)i[n]=new B.PQHandleElem;return i},B.fixOrientation_=function(t){for(var e=0,i=t.surface.fStart,n=i.there;n!==i;n=n.there){var r=n.anLine;if(!(r.follow<=0))do e+=(r.org.s-r.dst().s)*(r.org.t+r.dst().t),r=r.lThere;while(r!==n.anLine)}if(0>e){for(var o=t.surface.vStart,s=o.there;s!==o;s=s.there)s.t=-s.t;t.t[0]=-t.t[0],t.t[1]=-t.t[1],t.t[2]=-t.t[2]}},B.patchSpace_=function(t){var e=t.anLine;for(Ue(e.lThere!==e&&e.lThere.lThere!==e);B.pointLeq(e.dst(),e.org);)e=e.lPrev();for(;B.pointLeq(e.org,e.dst());)e=e.lThere;for(var i,n=e.lPrev();e.lThere!==n;)if(B.pointLeq(e.dst(),n.org)){for(;n.lThere!==e&&(B.lineGoesLeft(n.lThere)||B.lineSign(n.org,n.dst(),n.lThere.dst())<=0);)i=B.surface.connect(n.lThere,n),n=i.sym;n=n.lPrev()}else{for(;n.lThere!==e&&(B.lineGoesRight(e.lPrev())||B.lineSign(e.dst(),e.org,e.lPrev().org)>=0);)i=B.surface.connect(e,e.lPrev()),e=i.sym;e=e.lThere}for(Ue(n.lThere!==e);n.lThere.lThere!==e;)i=B.surface.connect(n.lThere,n),n=i.sym},B.surface=function(){},B.surface.makeLine=function(t){var e=B.surface.makeLinePair_(t.eStart);return B.surface.makepoint_(e,t.vStart),B.surface.makepoint_(e.sym,t.vStart),B.surface.makeFace_(e,t.fStart),e},B.surface.surfaceSplit=function(t,e){var i=!1,n=!1;t!==e&&(e.org!==t.org&&(n=!0,B.surface.killpoint_(e.org,t.org)),e.lFace!==t.lFace&&(i=!0,B.surface.killFace_(e.lFace,t.lFace)),B.surface.split_(e,t),n||(B.surface.makepoint_(e,t.org),t.org.anLine=t),i||(B.surface.makeFace_(e,t.lFace),t.lFace.anLine=t))},B.surface.killLine=function(t){var e=t.sym,i=!1;t.lFace!==t.rFace()&&(i=!0,B.surface.killFace_(t.lFace,t.rFace())),t.oThere===t?B.surface.killpoint_(t.org,!1):(t.rFace().anLine=t.oPrev(),t.org.anLine=t.oThere,B.surface.split_(t,t.oPrev()),i||B.surface.makeFace_(t,t.lFace)),e.oThere===e?(B.surface.killpoint_(e.org,!1),B.surface.killFace_(e.lFace,!1)):(t.lFace.anLine=e.oPrev(),e.org.anLine=e.oThere,B.surface.split_(e,e.oPrev())),B.surface.killLine_(t)},B.surface.addLinepoint=function(t){var e=B.surface.makeLinePair_(t),i=e.sym;return B.surface.split_(e,t.lThere),e.org=t.dst(),B.surface.makepoint_(i,e.org),e.lFace=i.lFace=t.lFace,e},B.surface.splitLine=function(t){var e=B.surface.addLinepoint(t),i=e.sym;return B.surface.split_(t.sym,t.sym.oPrev()),B.surface.split_(t.sym,i),t.sym.org=i.org,i.dst().anLine=i.sym,i.sym.lFace=t.rFace(),i.follow=t.follow,i.sym.follow=t.sym.follow,i},B.surface.connect=function(t,e){var i=!1,n=B.surface.makeLinePair_(t),r=n.sym;return e.lFace!==t.lFace&&(i=!0,B.surface.killFace_(e.lFace,t.lFace)),B.surface.split_(n,t.lThere),B.surface.split_(r,e),n.org=t.dst(),r.org=e.org,n.lFace=r.lFace=t.lFace,t.lFace.anLine=r,i||B.surface.makeFace_(n,t.lFace),n},B.surface.zapFace=function(t){var e,i=t.anLine,n=i.lThere;do if(e=n,n=e.lThere,e.lFace=!1,e.rFace()===!1){e.oThere===e?B.surface.killpoint_(e.org,!1):(e.org.anLine=e.oThere,B.surface.split_(e,e.oPrev()));var r=e.sym;r.oThere===r?B.surface.killpoint_(r.org,!1):(r.org.anLine=r.oThere,B.surface.split_(r,r.oPrev())),B.surface.killLine_(e)}while(e!==i);var o=t.prev,s=t.there;s.prev=o,o.there=s},B.surface.surfaceUnion=function(t,e){var i=t.fStart,n=t.vStart,r=t.eStart,o=e.fStart,s=e.vStart,a=e.eStart;return o.there!==o&&(i.prev.there=o.there,o.there.prev=i.prev,o.prev.there=i,i.prev=o.prev),s.there!==s&&(n.prev.there=s.there,s.there.prev=n.prev,s.prev.there=n,n.prev=s.prev),a.there!==a&&(r.sym.there.sym.there=a.there,a.there.sym.there=r.sym.there,a.sym.there.sym.there=r,r.sym.there=a.sym.there),t},B.surface.killlayer=function(){},B.surface.makeLinePair_=function(t){var e=new B.HalfLine,i=new B.HalfLine,n=t.sym.there;return i.there=n,n.sym.there=e,e.there=t,t.sym.there=i,e.sym=i,e.oThere=e,e.lThere=i,i.sym=e,i.oThere=i,i.lThere=e,e},B.surface.split_=function(t,e){var i=t.oThere,n=e.oThere;i.sym.lThere=e,n.sym.lThere=t,t.oThere=n,e.oThere=i},B.surface.makepoint_=function(t,e){var i=e.prev,n=new B.point(e,i);i.there=n,e.prev=n,n.anLine=t;var r=t;do r.org=n,r=r.oThere;while(r!==t)},B.surface.makeFace_=function(t,e){var i=e.prev,n=new B.Face(e,i);i.there=n,e.prev=n,n.anLine=t,n.inside=e.inside;var r=t;do r.lFace=n,r=r.lThere;while(r!==t)},B.surface.killLine_=function(t){var e=t.there,i=t.sym.there;e.sym.there=i,i.sym.there=e},B.surface.killpoint_=function(t,e){var i=t.anLine,n=i;do n.org=e,n=n.oThere;while(n!==i);var r=t.prev,o=t.there;o.prev=r,r.there=o},B.surface.killFace_=function(t,e){var i=t.anLine,n=i;do n.lFace=e,n=n.lThere;while(n!==i);var r=t.prev,o=t.there;o.prev=r,r.there=o},B.Face=function(t,e){this.there=t||this,this.prev=e||this,this.anLine=!1,this.stat=!1,this.trail=!1,this.marked=!1,this.inside=!1},B.HalfLine=function(t){this.there=t||this,this.sym=!1,this.oThere=!1,this.lThere=!1,this.org=!1,this.lFace=!1,this.region=!1,this.follow=0},B.HalfLine.prototype.rFace=function(){return this.sym.lFace},B.HalfLine.prototype.dst=function(){return this.sym.org},B.HalfLine.prototype.oPrev=function(){return this.sym.lThere},B.HalfLine.prototype.lPrev=function(){return this.oThere.sym},B.HalfLine.prototype.dPrev=function(){return this.lThere.sym},B.HalfLine.prototype.rPrev=function(){return this.sym.oThere},B.HalfLine.prototype.dThere=function(){return this.rPrev().sym},B.HalfLine.prototype.rThere=function(){return this.oPrev().sym},B.point=function(t,e){this.there=t||this,this.prev=e||this,this.anLine=!1,this.stat=!1,this.xys=[0,0,0],this.s=0,this.t=0,this.pqHandle=!1},B.layer=function(){this.vStart=new B.point,this.fStart=new B.Face,this.eStart=new B.HalfLine,this.eStartSym=new B.HalfLine,this.eStart.sym=this.eStartSym,this.eStartSym.sym=this.eStart},B.layer.prototype.fixlayer=function(){var t,e,i=this.fStart,n=this.vStart,r=this.eStart,o=i;for(o=i;(e=o.there)!==i;o=e){Ue(e.prev===o),t=e.anLine;do Ue(t.sym!==t),Ue(t.sym.sym===t),Ue(t.lThere.oThere.sym===t),Ue(t.oThere.sym.lThere===t),Ue(t.lFace===e),t=t.lThere;while(t!==e.anLine)}Ue(e.prev===o&&e.anLine===!1&&e.stat===!1);var s,a=n;for(a=n;(s=a.there)!==n;a=s){Ue(s.prev===a),t=s.anLine;do Ue(t.sym!==t),Ue(t.sym.sym===t),Ue(t.lThere.oThere.sym===t),Ue(t.oThere.sym.lThere===t),Ue(t.org===s),t=t.oThere;while(t!==s.anLine)}Ue(s.prev===a&&s.anLine===!1&&s.stat===!1);var l=r;for(l=r;(t=l.there)!==r;l=t)Ue(t.sym.there===l.sym),Ue(t.sym!==t),Ue(t.sym.sym===t),Ue(t.org!==!1),Ue(t.dst()!==!1),Ue(t.lThere.oThere.sym===t),Ue(t.oThere.sym.lThere===t);Ue(t.sym.there===l.sym&&t.sym===this.eStartSym&&t.sym.sym===t&&t.org===!1&&t.dst()===!1&&t.lFace===!1&&t.rFace()===!1)},B.SENTINEL_XY_=4*B.MAX_XY,B.EPSILON_NONZERO_=!1,B.computeInner=function(t){t.fatalFailure=!1,B.removeDeadLines_(t),B.initPriorityQ_(t),B.initLineDict_(t);for(var e;(e=t.pq.findMin())!==!1;){for(;;){var i=t.pq.minimum();if(i===!1||!B.pointEq(i,e))break;i=t.pq.findMin(),B.splitMergePoints_(t,e.anLine,i.anLine)}B.sweepEvent_(t,e)}var n=t.dict.start.there.key;t.event=n.eUp.org,B.sweepDebugEvent(t),B.doneLineDict_(t),B.done(t),B.removeDeadFaces_(t.surface),t.surface.fixlayer()},B.addFollow_=function(t,e){t.follow+=e.follow,t.sym.follow+=e.sym.follow},B.lineLeq_=function(t,e,i){var n=t.event,r=e.eUp,o=i.eUp;if(r.dst()===n)return o.dst()===n?B.pointLeq(r.org,o.org)?B.lineSign(o.dst(),r.org,o.org)<=0:B.lineSign(r.dst(),o.org,r.org)>=0:B.lineSign(o.dst(),n,o.org)<=0;if(o.dst()===n)return B.lineSign(r.dst(),n,r.org)>=0;var s=B.lineEval(r.dst(),n,r.org),a=B.lineEval(o.dst(),n,o.org);return s>=a
},B.killSpace_=function(t,e){e.fixUpperLine&&Ue(0===e.eUp.follow),e.eUp.region=!1,t.dict.killN(e.nUp),e.nUp=!1},B.fixUpperLine_=function(t,e){Ue(t.fixUpperLine),B.surface.killLine(t.eUp),t.fixUpperLine=!1,t.eUp=e,e.region=t},B.topLeftSpace_=function(t){var e=t.eUp.org;do t=t.spaceAbove();while(t.eUp.org===e);if(t.fixUpperLine){var i=B.surface.connect(t.spaceBelow().eUp.sym,t.eUp.lThere);B.fixUpperLine_(t,i),t=t.spaceAbove()}return t},B.topRightSpace_=function(t){var e=t.eUp.dst();do t=t.spaceAbove();while(t.eUp.dst()===e);return t},B.addSpaceBelow_=function(t,e,i){var n=new B.Region;return n.eUp=i,n.nUp=t.dict.addBefore(e.nUp,n),i.region=n,n},B.isFollowInside_=function(t,e){switch(t.command){case B.command.COMM_ODD:return 0!==(1&e);case B.command.COMM_NONZERO:return 0!==e;case B.command.COMM_POSITIVE:return e>0;case B.command.COMM_NEGATIVE:return 0>e;case B.command.COMM_ABS_GEQ_TWO:return e>=2||-2>=e}return Ue(!1),!1},B.computeFollow_=function(t,e){e.followId=e.spaceAbove().followId+e.eUp.follow,e.inside=B.isFollowInside_(t,e.followId)},B.finishSpace_=function(t,e){var i=e.eUp,n=i.lFace;n.inside=e.inside,n.anLine=i,B.killSpace_(t,e)},B.finishLeftSpaces_=function(t,e,i){for(var n=e,r=e.eUp;n!==i;){n.fixUpperLine=!1;var o=n.spaceBelow(),s=o.eUp;if(s&&s.org!==r.org){if(!o.fixUpperLine){B.finishSpace_(t,n);break}s=B.surface.connect(r.lPrev(),s.sym),B.fixUpperLine_(o,s)}r.oThere!==s&&(B.surface.surfaceSplit(s.oPrev(),s),B.surface.surfaceSplit(r,s)),B.finishSpace_(t,n),r=o.eUp,n=o}return r},B.addRightLines_=function(t,e,i,n,r,o){var s=!0,a=i;do Ue(B.pointLeq(a.org,a.dst())),B.addSpaceBelow_(t,e,a.sym),a=a.oThere;while(a!==n);r===!1&&(r=e.spaceBelow().eUp.rPrev());for(var l,p=e,u=r;l=p.spaceBelow(),a=l.eUp.sym,a.org===u.org;)a.oThere!==u&&(B.surface.surfaceSplit(a.oPrev(),a),B.surface.surfaceSplit(u.oPrev(),a)),l.followId=p.followId-a.follow,l.inside=B.isFollowInside_(t,l.followId),p.dirty=!0,!s&&B.fixForRightSplit_(t,p)&&(B.addFollow_(a,u),B.killSpace_(t,p),B.surface.killLine(u)),s=!1,p=l,u=a;p.dirty=!0,Ue(p.followId-a.follow===l.followId),o&&B.walkDirtySpaces_(t,p)},B.Combine_=function(t,e,i,n,r){var o=[e.xys[0],e.xys[1],e.xys[2]];e.stat=!1,e.stat=t.CombineOrCombineStat(o,i,n),e.stat===!1&&(r?t.fatalFailure||(t.FailureOrFailureStat(B.failureType.NEED_COMBINE_BACK),t.fatalFailure=!0):e.stat=i[0])},B.splitMergePoints_=function(t,e,i){var n=[!1,!1,!1,!1],r=[.5,.5,0,0];n[0]=e.org.stat,n[1]=i.org.stat,B.Combine_(t,e.org,n,r,!1),B.surface.surfaceSplit(e,i)},B.pointDepths_=function(t,e,i,n,r){var o=B.pointL1dist(e,t),s=B.pointL1dist(i,t),a=r,l=r+1;n[a]=.5*s/(o+s),n[l]=.5*o/(o+s),t.xys[0]+=n[a]*e.xys[0]+n[l]*i.xys[0],t.xys[1]+=n[a]*e.xys[1]+n[l]*i.xys[1],t.xys[2]+=n[a]*e.xys[2]+n[l]*i.xys[2]},B.WriteStat_=function(t,e,i,n,r,o){var s=[0,0,0,0],a=[i.stat,n.stat,r.stat,o.stat];e.xys[0]=e.xys[1]=e.xys[2]=0,B.pointDepths_(e,i,n,s,0),B.pointDepths_(e,r,o,s,2),B.Combine_(t,e,a,s,!0)},B.fixForRightSplit_=function(t,e){var i=e.spaceBelow(),n=e.eUp,r=i.eUp;if(B.pointLeq(n.org,r.org)){if(B.lineSign(r.dst(),n.org,r.org)>0)return!1;B.pointEq(n.org,r.org)?n.org!==r.org&&(t.pq.remove(n.org.pqHandle),B.splitMergePoints_(t,r.oPrev(),n)):(B.surface.splitLine(r.sym),B.surface.surfaceSplit(n,r.oPrev()),e.dirty=i.dirty=!0)}else{if(B.lineSign(n.dst(),r.org,n.org)<0)return!1;e.spaceAbove().dirty=e.dirty=!0,B.surface.splitLine(n.sym),B.surface.surfaceSplit(r.oPrev(),n)}return!0},B.fixForLeftSplit_=function(t,e){var i,n=e.spaceBelow(),r=e.eUp,o=n.eUp;if(Ue(!B.pointEq(r.dst(),o.dst())),B.pointLeq(r.dst(),o.dst())){if(B.lineSign(r.dst(),o.dst(),r.org)<0)return!1;e.spaceAbove().dirty=e.dirty=!0,i=B.surface.splitLine(r),B.surface.surfaceSplit(o.sym,i),i.lFace.inside=e.inside}else{if(B.lineSign(o.dst(),r.dst(),o.org)>0)return!1;e.dirty=n.dirty=!0,i=B.surface.splitLine(o),B.surface.surfaceSplit(r.lThere,o.sym),i.rFace().inside=e.inside}return!0},B.fixForWrite_=function(t,e){var i=e.spaceBelow(),n=e.eUp,r=i.eUp,o=n.org,s=r.org,a=n.dst(),l=r.dst(),p=new B.point;if(Ue(!B.pointEq(l,a)),Ue(B.lineSign(a,t.event,o)<=0),Ue(B.lineSign(l,t.event,s)>=0),Ue(o!==t.event&&s!==t.event),Ue(!e.fixUpperLine&&!i.fixUpperLine),o===s)return!1;var u=Math.min(o.t,a.t),h=Math.max(s.t,l.t);if(u>h)return!1;if(B.pointLeq(o,s)){if(B.lineSign(l,o,s)>0)return!1}else if(B.lineSign(a,s,o)<0)return!1;B.sweepDebugEvent(t),B.lineWrite(a,o,l,s,p),Ue(Math.min(o.t,a.t)<=p.t),Ue(p.t<=Math.max(s.t,l.t)),Ue(Math.min(l.s,a.s)<=p.s),Ue(p.s<=Math.max(s.s,o.s)),B.pointLeq(p,t.event)&&(p.s=t.event.s,p.t=t.event.t);var c=B.pointLeq(o,s)?o:s;if(B.pointLeq(c,p)&&(p.s=c.s,p.t=c.t),B.pointEq(p,o)||B.pointEq(p,s))return B.fixForRightSplit_(t,e),!1;if(!B.pointEq(a,t.event)&&B.lineSign(a,t.event,p)>=0||!B.pointEq(l,t.event)&&B.lineSign(l,t.event,p)<=0){if(l===t.event)return B.surface.splitLine(n.sym),B.surface.surfaceSplit(r.sym,n),e=B.topLeftSpace_(e),n=e.spaceBelow().eUp,B.finishLeftSpaces_(t,e.spaceBelow(),i),B.addRightLines_(t,e,n.oPrev(),n,n,!0),!0;if(a===t.event){B.surface.splitLine(r.sym),B.surface.surfaceSplit(n.lThere,r.oPrev()),i=e,e=B.topRightSpace_(e);var f=e.spaceBelow().eUp.rPrev();return i.eUp=r.oPrev(),r=B.finishLeftSpaces_(t,i,!1),B.addRightLines_(t,e,r.oThere,n.rPrev(),f,!0),!0}return B.lineSign(a,t.event,p)>=0&&(e.spaceAbove().dirty=e.dirty=!0,B.surface.splitLine(n.sym),n.org.s=t.event.s,n.org.t=t.event.t),B.lineSign(l,t.event,p)<=0&&(e.dirty=i.dirty=!0,B.surface.splitLine(r.sym),r.org.s=t.event.s,r.org.t=t.event.t),!1}return B.surface.splitLine(n.sym),B.surface.splitLine(r.sym),B.surface.surfaceSplit(r.oPrev(),n),n.org.s=p.s,n.org.t=p.t,n.org.pqHandle=t.pq.add(n.org),B.WriteStat_(t,n.org,o,a,s,l),e.spaceAbove().dirty=e.dirty=i.dirty=!0,!1},B.walkDirtySpaces_=function(t,e){for(var i=e.spaceBelow();;){for(;i.dirty;)e=i,i=i.spaceBelow();if(!e.dirty&&(i=e,e=e.spaceAbove(),e===!1||!e.dirty))return;e.dirty=!1;var n=e.eUp,r=i.eUp;if(n.dst()!==r.dst()&&B.fixForLeftSplit_(t,e)&&(i.fixUpperLine?(B.killSpace_(t,i),B.surface.killLine(r),i=e.spaceBelow(),r=i.eUp):e.fixUpperLine&&(B.killSpace_(t,e),B.surface.killLine(n),e=i.spaceAbove(),n=e.eUp)),n.org!==r.org)if(n.dst()===r.dst()||e.fixUpperLine||i.fixUpperLine||n.dst()!==t.event&&r.dst()!==t.event)B.fixForRightSplit_(t,e);else if(B.fixForWrite_(t,e))return;n.org===r.org&&n.dst()===r.dst()&&(B.addFollow_(r,n),B.killSpace_(t,e),B.surface.killLine(n),e=i.spaceAbove())}},B.connectightpoint_=function(t,e,i){var n=i.oThere,r=e.spaceBelow(),o=e.eUp,s=r.eUp,a=!1;if(o.dst()!==s.dst()&&B.fixForWrite_(t,e),B.pointEq(o.org,t.event)&&(B.surface.surfaceSplit(n.oPrev(),o),e=B.topLeftSpace_(e),n=e.spaceBelow().eUp,B.finishLeftSpaces_(t,e.spaceBelow(),r),a=!0),B.pointEq(s.org,t.event)&&(B.surface.surfaceSplit(i,s.oPrev()),i=B.finishLeftSpaces_(t,r,!1),a=!0),a)return B.addRightLines_(t,e,i.oThere,n,n,!0),void 0;var l=B.pointLeq(s.org,o.org)?s.oPrev():o;l=B.surface.connect(i.lPrev(),l),B.addRightLines_(t,e,l,l.oThere,l.oThere,!1),l.sym.region.fixUpperLine=!0,B.walkDirtySpaces_(t,e)},B.connectLeftDead_=function(t,e,i){var n=e.eUp;if(B.pointEq(n.org,i))return Ue(B.EPSILON_NONZERO_),B.splitMergePoints_(t,n,i.anLine);if(!B.pointEq(n.dst(),i))return B.surface.splitLine(n.sym),e.fixUpperLine&&(B.surface.killLine(n.oThere),e.fixUpperLine=!1),B.surface.surfaceSplit(i.anLine,n),B.sweepEvent_(t,i);Ue(B.EPSILON_NONZERO_),e=B.topRightSpace_(e);var r=e.spaceBelow(),o=r.eUp.sym,s=o.oThere,a=s;r.fixUpperLine&&(Ue(s!==o),B.killSpace_(t,r),B.surface.killLine(o),o=s.oPrev()),B.surface.surfaceSplit(i.anLine,o),B.lineGoesLeft(s)||(s=!1),B.addRightLines_(t,e,o.oThere,a,s,!0)},B.connectLeftpoint_=function(t,e){var i=new B.Region;i.eUp=e.anLine.sym;var n,r=t.dict.search(i).key,o=r.spaceBelow(),s=r.eUp,a=o.eUp;if(0===B.lineSign(s.dst(),e,s.org))return B.connectLeftDead_(t,r,e);var l=B.pointLeq(a.dst(),s.dst())?r:o;if(r.inside||l.fixUpperLine){if(l===r)n=B.surface.connect(e.anLine.sym,s.lThere);else{var p=B.surface.connect(a.dThere(),e.anLine);n=p.sym}l.fixUpperLine?B.fixUpperLine_(l,n):B.computeFollow_(t,B.addSpaceBelow_(t,r,n)),B.sweepEvent_(t,e)}else B.addRightLines_(t,r,e.anLine,e.anLine,!1,!0)},B.sweepEvent_=function(t,e){t.event=e,B.sweepDebugEvent(t);for(var i=e.anLine;i.region===!1;)if(i=i.oThere,i===e.anLine)return B.connectLeftpoint_(t,e);var n=B.topLeftSpace_(i.region),r=n.spaceBelow(),o=r.eUp,s=B.finishLeftSpaces_(t,r,!1);s.oThere===o?B.connectightpoint_(t,n,s):B.addRightLines_(t,n,s.oThere,o,o,!0)},B.addSentinel_=function(t,e){var i=new B.Region,n=B.surface.makeLine(t.surface);n.org.s=B.SENTINEL_XY_,n.org.t=e,n.dst().s=-B.SENTINEL_XY_,n.dst().t=e,t.event=n.dst(),i.eUp=n,i.followId=0,i.inside=!1,i.fixUpperLine=!1,i.sentinel=!0,i.dirty=!1,i.nUp=t.dict.add(i)},B.initLineDict_=function(t){t.dict=new B.Dict(t,B.lineLeq_),B.addSentinel_(t,-B.SENTINEL_XY_),B.addSentinel_(t,B.SENTINEL_XY_)},B.doneLineDict_=function(t){for(var e,i=0;(e=t.dict.start.there.key)!==!1;)e.sentinel||(Ue(e.fixUpperLine),Ue(1===++i)),Ue(0===e.followId),B.killSpace_(t,e);t.dict=!1},B.removeDeadLines_=function(t){for(var e,i=t.surface.eStart,n=i.there;n!==i;n=e){e=n.there;var r=n.lThere;B.pointEq(n.org,n.dst())&&n.lThere.lThere!==n&&(B.splitMergePoints_(t,r,n),B.surface.killLine(n),n=r,r=n.lThere),r.lThere===n&&(r!==n&&((r===e||r===e.sym)&&(e=e.there),B.surface.killLine(r)),(n===e||n===e.sym)&&(e=e.there),B.surface.killLine(n))}},B.initPriorityQ_=function(e){var i=new t(B.pointLeq);e.pq=i;for(var n=e.surface.vStart,r=n.there;r!==n;r=r.there)r.pqHandle=i.add(r);i.init()},B.done=function(t){t.pq=!1},B.removeDeadFaces_=function(t){for(var e,i=t.fStart.there;i!==t.fStart;i=e){e=i.there;var n=i.anLine;Ue(n.lThere!==n),n.lThere.lThere===n&&(B.addFollow_(n.oThere,n),B.surface.killLine(n))}},B.Region=function(){this.eUp=!1,this.nUp=!1,this.followId=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperLine=!1},B.Region.prototype.spaceBelow=function(){return this.nUp.prev.key},B.Region.prototype.spaceAbove=function(){return this.nUp.there.key},B.drawlayer=function(t,e){t.lonelyTList=!1;var i;for(i=e.fStart.there;i!==e.fStart;i=i.there)i.marked=!1;for(i=e.fStart.there;i!==e.fStart;i=i.there)i.inside&&!i.marked&&(B.drawMaximumFaceGroup_(t,i),Ue(i.marked));t.lonelyTList!==!1&&(B.drawLonelyTangles_(t,t.lonelyTList),t.lonelyTList=!1)},B.drawLine=function(t,e){for(var i=e.fStart.there;i!==e.fStart;i=i.there)if(i.inside){t.StartOrStartStat(ze.LINE_LOOP);var n=i.anLine;do t.pointOrpointStat(n.org.stat),n=n.lThere;while(n!==i.anLine);t.EndOrEndStat()}},B.drawStore=function(t){if(t.storeCount<3)return!0;var e=[0,0,0];e[0]=t.perp[0],e[1]=t.perp[1],e[2]=t.perp[2],0===e[0]&&0===e[1]&&0===e[2]&&B.computePerp_(t,e,!1);var i=B.computePerp_(t,e,!0);if(i===B.SIGN_INCONSISTENT_)return!1;if(0===i)return!0;switch(t.command){case B.command.COMM_ODD:case B.command.COMM_NONZERO:break;case B.command.COMM_POSITIVE:if(0>i)return!0;break;case B.command.COMM_NEGATIVE:if(i>0)return!0;break;case B.command.COMM_ABS_GEQ_TWO:return!0}t.StartOrStartStat(t.lineOnly?ze.LINE_LOOP:t.storeCount>3?ze.MALAANGLE_FAN:ze.TRIANGLES);var n,r=0,o=r+t.storeCount;if(t.pointOrpointStat(t.store[r].stat),i>0)for(n=r+1;o>n;++n)t.pointOrpointStat(t.store[n].stat);else for(n=o-1;n>r;--n)t.pointOrpointStat(t.store[n].stat);return t.EndOrEndStat(),!0},B.marked_=function(t){return!t.inside||t.marked},B.fTrail_=function(t){for(;t!==!1;)t.marked=!1,t=t.trail},B.maximumFan_=function(t){var e,i=new B.Count(0,!1,B.drawFan_),n=!1;for(e=t;!B.marked_(e.lFace);e=e.oThere)e.lFace.trail=n,n=e.lFace,e.lFace.marked=!0,++i.size;for(e=t;!B.marked_(e.rFace());e=e.oPrev())e.rFace().trail=n,n=e.rFace(),e.rFace().marked=!0,++i.size;return i.eStart=e,B.fTrail_(n),i},B.maximumSTp_=function(t){var e,i,n,r=new B.Count(0,!1,B.drawSTp_),o=0,s=o,a=!1;for(e=t;!B.marked_(e.lFace)&&(e.lFace.trail=a,a=e.lFace,e.lFace.marked=!0,++s,e=e.dPrev(),!B.marked_(e.lFace));++s,e=e.oThere)e.lFace.trail=a,a=e.lFace,e.lFace.marked=!0;for(i=e,e=t;!B.marked_(e.rFace())&&(e.rFace().trail=a,a=e.rFace(),e.rFace().marked=!0,++o,e=e.oPrev(),!B.marked_(e.rFace()));++o,e=e.dThere())e.rFace().trail=a,a=e.rFace(),e.rFace().marked=!0;return n=e,r.size=s+o,0===(1&s)?r.eStart=i.sym:0===(1&o)?r.eStart=n:(--r.size,r.eStart=n.oThere),B.fTrail_(a),r},B.drawFan_=function(t,e,i){for(t.StartOrStartStat(ze.MALAANGLE_FAN),t.pointOrpointStat(e.org.stat),t.pointOrpointStat(e.dst().stat);!B.marked_(e.lFace);)e.lFace.marked=!0,--i,e=e.oThere,t.pointOrpointStat(e.dst().stat);Ue(0===i),t.EndOrEndStat()},B.drawSTp_=function(t,e,i){for(t.StartOrStartStat(ze.MALAANGLE_SMALAP),t.pointOrpointStat(e.org.stat),t.pointOrpointStat(e.dst().stat);!B.marked_(e.lFace)&&(e.lFace.marked=!0,--i,e=e.dPrev(),t.pointOrpointStat(e.org.stat),!B.marked_(e.lFace));)e.lFace.marked=!0,--i,e=e.oThere,t.pointOrpointStat(e.dst().stat);Ue(0===i),t.EndOrEndStat()},B.drawTangle_=function(t,e,i){Ue(1===i),e.lFace.trail=t.lonelyTList,t.lonelyTList=e.lFace,e.lFace.marked=!0},B.Eval=function(t,e,i){Ue(B.Leq(t,e)&&B.Leq(e,i));var n=e.t-t.t,r=i.t-e.t;return n+r>0?r>n?e.s-t.s+(t.s-i.s)*(n/(n+r)):e.s-i.s+(i.s-t.s)*(r/(n+r)):0},B.drawMaximumFaceGroup_=function(t,e){var i,n=e.anLine,r=new B.Count(1,n,B.drawTangle_);t.flagLine||(i=B.maximumFan_(n),i.size>r.size&&(r=i),i=B.maximumFan_(n.lThere),i.size>r.size&&(r=i),i=B.maximumFan_(n.lPrev()),i.size>r.size&&(r=i),i=B.maximumSTp_(n),i.size>r.size&&(r=i),i=B.maximumSTp_(n.lThere),i.size>r.size&&(r=i),i=B.maximumSTp_(n.lPrev()),i.size>r.size&&(r=i)),r.draw(t,r.eStart,r.size)},B.drawLonelyTangles_=function(t,e){var i=-1,n=e;for(t.StartOrStartStat(ze.TRIANGLES);n!==!1;n=n.trail){var r=n.anLine;do{if(t.flagLine){var o=r.rFace().inside?0:1;i!==o&&(i=o,t.LineFlagOrLineFlagStat(!!i))}t.pointOrpointStat(r.org.stat),r=r.lThere}while(r!==n.anLine)}t.EndOrEndStat()},B.computePerp_=function(t,e,i){i||(e[0]=e[1]=e[2]=0);for(var n=0,r=n+t.storeCount,o=n+1,s=t.store[n],a=t.store[o],l=a.xys[0]-s.xys[0],p=a.xys[1]-s.xys[1],u=a.xys[2]-s.xys[2],h=0;++o<r;){a=t.store[o];var c=l,f=p,d=u;l=a.xys[0]-s.xys[0],p=a.xys[1]-s.xys[1],u=a.xys[2]-s.xys[2];var e=[0,0,0];e[0]=f*u-d*p,e[1]=d*l-c*u,e[2]=c*p-f*l;var _=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(i){if(0!==_)if(_>0){if(0>h)return B.SIGN_INCONSISTENT_;h=1}else{if(h>0)return B.SIGN_INCONSISTENT_;h=-1}}else _>=0?(e[0]+=e[0],e[1]+=e[1],e[2]+=e[2]):(e[0]-=e[0],e[1]-=e[1],e[2]-=e[2])}return h},B.Count=function(t,e,i){this.size=t,this.eStart=e,this.draw=i},B.pointEq=function(t,e){return t.s===e.s&&t.t===e.t},B.pointLeq=function(t,e){return t.s<e.s||t.s===e.s&&t.t<=e.t},B.lineEval=function(t,e,i){Ue(B.pointLeq(t,e)&&B.pointLeq(e,i));var n=e.s-t.s,r=i.s-e.s;return n+r>0?r>n?e.t-t.t+(t.t-i.t)*(n/(n+r)):e.t-i.t+(i.t-t.t)*(r/(n+r)):0},B.lineSign=function(t,e,i){Ue(B.pointLeq(t,e)&&B.pointLeq(e,i));var n=e.s-t.s,r=i.s-e.s;return n+r>0?(e.t-i.t)*n+(e.t-t.t)*r:0},B.Leq=function(t,e){return t.t<e.t||t.t===e.t&&t.s<=e.s},B.Sign=function(t,e,i){Ue(B.Leq(t,e)&&B.Leq(e,i));var n=e.t-t.t,r=i.t-e.t;return n+r>0?(e.s-i.s)*n+(e.s-t.s)*r:0},B.lineGoesLeft=function(t){return B.pointLeq(t.dst(),t.org)},B.lineGoesRight=function(t){return B.pointLeq(t.org,t.dst())},B.pointL1dist=function(t,e){return Math.abs(t.s-e.s)+Math.abs(t.t-e.t)},B.pointCCW=function(t,e,i){return t.s*(e.t-i.t)+e.s*(i.t-t.t)+i.s*(t.t-e.t)>=0},B.merge_=function(t,e,i,n){return t=0>t?0:t,i=0>i?0:i,i>=t?0===i?(e+n)/2:e+(n-e)*(t/(t+i)):n+(e-n)*(i/(t+i))},B.lineWrite=function(t,e,i,n,r){var o,s,a;B.pointLeq(t,e)||(a=t,t=e,e=a),B.pointLeq(i,n)||(a=i,i=n,n=a),B.pointLeq(t,i)||(a=t,t=i,i=a,a=e,e=n,n=a),B.pointLeq(i,e)?B.pointLeq(e,n)?(o=B.lineEval(t,i,e),s=B.lineEval(i,e,n),0>o+s&&(o=-o,s=-s),r.s=B.merge_(o,i.s,s,e.s)):(o=B.lineSign(t,i,e),s=-B.lineSign(t,n,e),0>o+s&&(o=-o,s=-s),r.s=B.merge_(o,i.s,s,n.s)):r.s=(i.s+e.s)/2,B.Leq(t,e)||(a=t,t=e,e=a),B.Leq(i,n)||(a=i,i=n,n=a),B.Leq(t,i)||(a=t,t=i,i=a,a=e,e=n,n=a),B.Leq(i,e)?B.Leq(e,n)?(o=B.Eval(t,i,e),s=B.Eval(i,e,n),0>o+s&&(o=-o,s=-s),r.t=B.merge_(o,i.t,s,e.t)):(o=B.Sign(t,i,e),s=-B.Sign(t,n,e),0>o+s&&(o=-o,s=-s),r.t=B.merge_(o,i.t,s,n.t)):r.t=(i.t+e.t)/2},B.projectShape=function(t){var e=!1,i=[0,0,0];i[0]=t.perp[0],i[1]=t.perp[1],i[2]=t.perp[2],0===i[0]&&0===i[1]&&0===i[2]&&(B.computePerp_(t,i),e=!0);var n=t.s,r=t.t,o=B.longAxis_(i);if(B.TRUE_PROJECT){B.perpize_(i),n[o]=0,n[(o+1)%3]=B.S__X_,n[(o+2)%3]=B.S__Y_;var s=B.dot_(n,i);n[0]-=s*i[0],n[1]-=s*i[1],n[2]-=s*i[2],B.perpize_(n),r[0]=i[1]*n[2]-i[2]*n[1],r[1]=i[2]*n[0]-i[0]*n[2],r[2]=i[0]*n[1]-i[1]*n[0],B.perpize_(r)}else n[o]=0,n[(o+1)%3]=B.S__X_,n[(o+2)%3]=B.S__Y_,r[o]=0,r[(o+1)%3]=i[o]>0?-B.S__Y_:B.S__Y_,r[(o+2)%3]=i[o]>0?B.S__X_:-B.S__X_;for(var a=t.surface.vStart,l=a.there;l!==a;l=l.there)l.s=B.dot_(l.xys,n),l.t=B.dot_(l.xys,r);e&&B.fixOrientation_(t)},B.dot_=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},B.perpize_=function(t){var e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];Ue(e>0),e=Math.sqrt(e),t[0]/=e,t[1]/=e,t[2]/=e},B.longAxis_=function(t){var e=0;return Math.abs(t[1])>Math.abs(t[e])&&(e=1),Math.abs(t[2])>Math.abs(t[e])&&(e=2),e},B.computePerp_=function(t,e){var i=[0,0,0],n=[0,0,0],r=[0,0,0],o=[0,0,0],s=[0,0,0];i[0]=i[1]=i[2]=-2*B.MAX_XY,n[0]=n[1]=n[2]=2*B.MAX_XY;var a,l,p=new Array(3),u=new Array(3),h=t.surface.vStart;for(l=h.there;l!==h;l=l.there)for(a=0;3>a;++a){var c=l.xys[a];c<n[a]&&(n[a]=c,u[a]=l),c>i[a]&&(i[a]=c,p[a]=l)}if(a=0,i[1]-n[1]>i[0]-n[0]&&(a=1),i[2]-n[2]>i[a]-n[a]&&(a=2),n[a]>=i[a])return e[0]=0;e[1]=0,e[2]=1;var f=0,d=u[a],_=p[a];for(r[0]=d.xys[0]-_.xys[0],r[1]=d.xys[1]-_.xys[1],r[2]=d.xys[2]-_.xys[2],l=h.there;l!==h;l=l.there){o[0]=l.xys[0]-_.xys[0],o[1]=l.xys[1]-_.xys[1],o[2]=l.xys[2]-_.xys[2],s[0]=r[1]*o[2]-r[2]*o[1],s[1]=r[2]*o[0]-r[0]*o[2],s[2]=r[0]*o[1]-r[1]*o[0];var y=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];y>f&&(f=y,e[0]=s[0],e[1]=s[1],e[2]=s[2])}0>=f&&(e[0]=e[1]=e[2]=0,e[B.longAxis_(r)]=1)},B.patchInner=function(t){for(var e=t.fStart.there,i=e.there;e!==t.fStart;i=(e=i).there)e.inside&&B.patchSpace_(e)},B.discardOuter=function(t){for(var e=t.fStart.there,i=e.there;e!==t.fStart;i=(e=i).there)e.inside||B.surface.zapFace(e)},B.FollowId=function(t,e,i){for(var n,r=t.eStart.there;r!==t.eStart;r=n,n=r.there)r.rFace().inside!==r.lFace.inside?r.follow=r.lFace.inside?e:-e:i?B.surface.killLine(r):r.follow=0};var De=(new B).on(B.opt.POINT_STAT,function(t,e){e.push(t[0],t[1])}).on(B.opt.COMBINE,function(t){return t.slice(0,2)}).on(B.opt.LINE_FLAG,r),Be={};window.p=Be;var We={},Ge={" ":function(t){return t&&t!==__scene__&&t.parent()},">":function(t,e){return t&&t.parent()==e.parent()&&t.parent()},"~":function(t){return t&&t.previousSibling()},"+":function(t,e,i,n){return!t||(i=ne(t))&&(n=ne(e))&&i==n&&i}},Xe=/^(\*|\w+)?(?:([\.\#]+[\w\-\.#]+)?)(\[([\w\-]+)(?:([\|\^\$\*\~]?\=)['"]?([ \w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^]+)["']?)?\])?(:([\w\-]+)(\(['"]?([^()]+)['"]?\))?)?/,He={circle:{init:function(t){this.fBuffer[4*t]=1,this.indices=[4*t]},cx:function(t){this.posBuffer[this.indices[0]+0]=t},cy:function(t){this.posBuffer[this.indices[0]+1]=t},r:function(t){this.posBuffer[this.indices[0]+2]=t},cz:function(t){this.posBuffer[this.indices[0]+3]=t},fill:function(t){this.colorBuffer[this.indices[0]]=0>t?t:g(t)},stroke:function(t){this.colorBuffer[this.indices[0]]=g(t)}},ellipse:{init:function(){},cx:r,cy:r,rx:r,ry:r},rect:{init:function(t){this.fBuffer[4*t]=0,this.indices=[4*t]},fill:function(t){this.colorBuffer[this.indices[0]]=0>t?t:g(t)},x:function(t){this.posBuffer[this.indices[0]+0]=t},y:function(t){this.posBuffer[this.indices[0]+1]=t},width:function(t){this.posBuffer[this.indices[0]+2]=t},height:function(t){this.posBuffer[this.indices[0]+3]=t},rx:r,ry:r},image:{init:function(){},"xlink:href":r,height:r,width:r,x:r,y:r},line:{init:function(t){this.indices=[2*t,2*t+1]},x1:function(t){this.posBuffer[2*this.indices[0]]=t},y1:function(t){this.posBuffer[2*this.indices[0]+1]=t},x2:function(t){this.posBuffer[2*this.indices[1]]=t},y2:function(t){this.posBuffer[2*this.indices[1]+1]=t},stroke:function(t){var e=g(t);this.indices.forEach(function(t){this.colorBuffer[4*t]=e},this)}},path:{init:function(){this.indices=[]},d:pe,pathLength:r,fill:function(t){var e=g(t);this.indices.forEach(function(t){this.colorBuffer[4*t]=e},this)}},polygon:{init:function(){},points:r},polyline:{init:function(t){this.indices=[2*t,2*t+1]},points:r},g:{init:function(){},appendChild:function(t){this.children.push(he(t))},ctr:function(){this.children=[]}},text:{init:function(){},x:r,y:r,dx:r,dy:r}},je={gl:Fe,children:Object.freeze([]),querySelector:Q,querySelectorAll:Z,createElementNS:o,insertBefore:r,ownerDocument:{createElementNS:function(t,e){return e}},previousSibling:function(){canvas.__scene__[canvas.__scene__.indexOf(this)-1]},nextSibling:function(){canvas.__scene__[canvas.__scene__.indexOf()+1]},parentNode:!1,removeChild:function(t){var e=canvas.__scene__;e.splice(e.indexOf(t),1)},opacity:function(t){this.fBuffer[this.indices[0]+1]=256-256*t},transform:function(){},getAttribute:function(t){return this.attr[t]},setAttribute:function(t,e){this.attr[t]=e,this[t]&&this[t](e),e&&e.texture&&this.mesh.bindMaterial(t,e)},removeAttribute:function(t){delete this.attr[t]},textContent:r,removeEventListener:r,addEventListener:X,style:{setProperty:r},ownerSVGElement:{createSVGPoint:r},trigger:function(t){console.log(t)}};je.parentNode=je;var Ye=[function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}];fe.prototype={update:function(t){this.data?Fe.texImage2D(Fe.TEXTURE_2D,0,Fe.RGBA,Fe.RGBA,Fe.UNSIGNED_BYTE,t||this.data):Fe.texImage2D(Fe.TEXTURE_2D,0,Fe.RGBA,this.width,this.height,0,Fe.RGBA,Fe.FLOAT,null)},size:function(t,e){return arguments.length?(this.width=t,this.height=e||t,this):this.width*this.height},z:function(){var t=Math.sqrt(this.size());return function(e,i){return-1/t*~~(i%t)}},x:function(){var t=Math.sqrt(this.size());return function(e,i){return-1/t*~~(i%t)}},y:function(){var t=Math.sqrt(this.size());return function(e,i){return-1/t*~~(i/t)}},subImage:function(t,e,i){Fe.bindTexture(Fe.TEXTURE_2D,this.texture),Fe.texSubImage2D(Fe.TEXTURE_2D,0,t,e,i.length/4,1,Fe.RGBA,Fe.FLOAT,new Float32Array(i))},repeat:function(){return this.task=function(){this.update()}.bind(this),Ae.push(this.task),this},stop:function(){this.task&&Ae.splice(Ae.indexOf(this.task)),delete this.task},appendChild:function(t){return this.__renderTarget__||ve.call(this),this.__scene__[this.__scene__.length]=this.__renderTarget__.append(t.tagName||t)},valueOf:function(){return-this.id},copy:function(){return we.texture(this.src)},pipe:ye,querySelector:Q,querySelectorAll:Z,ownerDocument:{createElementNS:function(t,e){return e}},unwrap:ge,adnan:!0};var Ve=["attribute vec2 pos;","  void main() {","  gl_Position = vec4(pos.xy, 1.0 , 1.0);","  }"].join("\n"),$e=["uniform sampler2D texture;","uniform vec2 resolution;","uniform vec2 mouse;","uniform vec2 dimensions;","uniform float gravity;","uniform float inertia;","uniform float drag;","uniform float clock;","void main() {","vec2 TARGET = vec2(mouse / resolution);","vec4 data = texture2D(texture, (gl_FragCoord.xy) / dimensions);","vec2 pos = data.xy;","vec2 vel = data.zw;","if (pos.x > 1. || pos.x < 0. || pos.y > 1. || pos.y < 0.) vel *= -1.; ","pos += inertia  * vel;","vel += gravity * normalize(TARGET - pos);","vel *= drag;","gl_FragColor = vec4(pos, vel);","}"].join("\n");Date.now(),we.sim.particles=function(t){function e(){we.uniform("gravity",-1*we.uniform("gravity"))}function i(){we.uniform("dimensions",[s,a]),we.uniform("gravity",.1),we.uniform("inertia",.003),we.uniform("drag",.996);for(var t=-1;++t<10;)r(o/10,[1,2].map(Math.random))}function n(t,e){r(e||o*Math.random(),t||[0,0])}function r(t,e){var i=~~(p%s),n=~~(p/a),r=[{x:i,y:n,size:t}];!function l(t){var e=t.x+t.size,i=e-s;s>e||(t.size-=i,r.push(t={x:0,y:(t.y+1)%a,size:i}),l(t))}(r[0]),r.forEach(function(t){for(var i=[],n=-1;++n<t.size;)i.push(e[0],e[1],Ee(-1,1),Ee(-1,1));u.subImage(t.x,t.y,i)}),p+=t,p%=o}var o=l(t),s=Math.sqrt(o),a=s,p=0,u=we.texture(o),h=we.shader().map($e);return u.pipe(h),h.pipe(u),h.invalidate(),setTimeout(i,1e3),d(u,{emit:n,reverse:e})}}();